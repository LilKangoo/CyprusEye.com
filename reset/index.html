<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FCSE0876CR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FCSE0876CR');
</script>

<meta charset="utf-8">
<title>Set new password</title>
<meta name="ce-auth" content="on">
<meta name="supabase-url" content="https://daoohnbnnowmmcizgvrq.supabase.co">
<meta name="supabase-anon" content="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRhb29obmJubm93bW1jaXpndnJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3NjkwNDksImV4cCI6MjA3NjM0NTA0OX0.AJrmxrk18yWxL1_Ejk_SZ1-X04YxN4C8LXCn9c3yFSM">
<meta name="supabase-publishable" content="sb_publishable_QdxNGCb6LYD-6ywFrjCrjg_Oa7yDGTk">
</head>
<body>
<form id="setpw"><label>New password
  <input type="password" name="password" required minlength="6" autocomplete="new-password">
</label><button type="submit">Set new password</button></form>
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
import { ensureSupabaseMeta } from "/assets/js/auth/config.js";

const { url, anon, publishable: pub } = ensureSupabaseMeta();

const supabase = createClient(url, anon, {
  auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true },
  global: {
    headers: pub
      ? { 'x-application-name': 'CyprusEye', 'x-publishable-key': pub }
      : { 'x-application-name': 'CyprusEye' },
  },
});
const { data: sessionData, error } = await supabase.auth.getSession();
if (error) console.error('Supabase session error', error);
if (!sessionData.session) console.warn('Supabase: brak aktywnej sesji resetu.');
const form = document.getElementById('setpw');
form?.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const pw = e.target.password.value;
  const { error: updateError } = await supabase.auth.updateUser({ password: pw });
  if (updateError) alert(updateError.message); else window.location.href = '/account/';
});
</script>
</body>
</html>
