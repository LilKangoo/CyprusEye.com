import{sb,supabase}from"/js/supabaseClient.js";const adminState={user:null,profile:null,isAdmin:!1,currentView:"dashboard"},$=selector=>document.querySelector(selector);async function handleLogout(){try{const client=sb||supabase||window.supabase;client&&await client.auth.signOut(),window.location.replace("/admin/login.html")}catch(error){console.error("Logout failed:",error),window.location.replace("/admin/login.html")}}async function initAdminDashboard(){await async function(){try{const client=sb||supabase||window.supabase;if(!client)return!1;const{data:{session:session}}=await client.auth.getSession();if(!session||!session.user)return!1;adminState.user=session.user;const{data:profile}=await client.from("profiles").select("*").eq("id",session.user.id).single();return profile&&(adminState.profile=profile,adminState.isAdmin=profile.is_admin),function(){const nameEl=$("#adminUserName");nameEl&&adminState.profile&&(nameEl.textContent=adminState.profile.username||adminState.profile.name||adminState.user.email)}(),!0}catch(error){return console.error("Failed to load profile:",error),!1}}();const container=$("#adminContainer");var el;container&&(el=container)&&(el.hidden=!1);const logoutBtn=$("#btnAdminLogout");logoutBtn&&logoutBtn.addEventListener("click",async e=>{e.preventDefault(),await handleLogout()})}window.adminState=adminState,window.handleLogout=handleLogout,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initAdminDashboard):initAdminDashboard();