let poiAutoSaveTimer=null;function renderPOII18nForm(poi=null){const languages=[{code:"pl",label:"ðŸ‡µðŸ‡± Polski",required:!0,rtl:!1},{code:"en",label:"ðŸ‡¬ðŸ‡§ English",required:!0,rtl:!1},{code:"el",label:"ðŸ‡¬ðŸ‡· Î•Î»Î»Î·Î½Î¹ÎºÎ¬",required:!1,rtl:!1},{code:"he",label:"ðŸ‡®ðŸ‡± ×¢×‘×¨×™×ª",required:!1,rtl:!0}],draftKey=`poi_draft_${poi?.id||"new"}`,draft=localStorage.getItem(draftKey),data=draft?JSON.parse(draft):poi;return`\n    <form id="poiI18nForm" onsubmit="handlePOII18nSubmit(event)" oninput="schedulePoiAutoSave()">\n      ${draft?`\n        <div class="draft-notice">\n          ðŸ’¾ Draft saved: ${new Date(JSON.parse(draft).savedAt).toLocaleString()}\n          <button type="button" onclick="clearPoiDraft('${draftKey}')">Clear</button>\n        </div>\n      `:""}\n      \n      \x3c!-- Basic fields (non-translatable) --\x3e\n      <div class="form-section">\n        <h4>Basic Information</h4>\n        <div class="form-row">\n          <div class="form-field">\n            <label>Latitude *</label>\n            <input type="number" name="lat" step="any" value="${data?.lat||data?.latitude||""}" required>\n          </div>\n          <div class="form-field">\n            <label>Longitude *</label>\n            <input type="number" name="lng" step="any" value="${data?.lng||data?.longitude||""}" required>\n          </div>\n        </div>\n        <div class="form-row">\n          <div class="form-field">\n            <label>XP Points</label>\n            <input type="number" name="xp" value="${data?.xp||100}">\n          </div>\n          <div class="form-field">\n            <label>Radius (m)</label>\n            <input type="number" name="radius" value="${data?.radius||500}">\n          </div>\n          <div class="form-field">\n            <label>Status</label>\n            <select name="status">\n              <option value="published" ${"published"===data?.status?"selected":""}>Published</option>\n              <option value="draft" ${"draft"===data?.status?"selected":""}>Draft</option>\n              <option value="hidden" ${"hidden"===data?.status?"selected":""}>Hidden</option>\n            </select>\n          </div>\n        </div>\n        <div class="form-field">\n          <label>Google Maps URL</label>\n          <input type="url" name="google_url" value="${data?.google_url||""}">\n        </div>\n      </div>\n      \n      \x3c!-- Language tabs --\x3e\n      <div class="form-section">\n        <h4>Translations</h4>\n        <p class="form-hint">ðŸ‡µðŸ‡± Polish and ðŸ‡¬ðŸ‡§ English are required</p>\n        \n        <div class="lang-tabs">\n          ${languages.map((lang,i)=>`\n            <button type="button" \n                    class="lang-tab ${0===i?"active":""}" \n                    data-lang="${lang.code}"\n                    onclick="switchPoiLangTab('${lang.code}')">\n              ${lang.label} ${lang.required?'<span class="required">*</span>':""}\n            </button>\n          `).join("")}\n        </div>\n        \n        ${languages.map((lang,i)=>`\n          <div class="lang-content ${0===i?"active":""}" \n               data-lang="${lang.code}"\n               ${lang.rtl?'dir="rtl"':""}>\n            \n            <div class="form-field">\n              <label>Name (${lang.code.toUpperCase()}) ${lang.required?"*":""}</label>\n              <input type="text" \n                     name="name_${lang.code}" \n                     value="${data?.name_i18n?.[lang.code]||"pl"===lang.code&&data?.name||""}"\n                     ${lang.required?"required":""}\n                     placeholder="Enter POI name in ${lang.label}">\n            </div>\n            \n            <div class="form-field">\n              <label>Description (${lang.code.toUpperCase()}) ${lang.required?"*":""}</label>\n              <textarea name="description_${lang.code}" \n                        rows="4"\n                        ${lang.required?"required":""}\n                        placeholder="Enter description in ${lang.label}">${data?.description_i18n?.[lang.code]||"pl"===lang.code&&data?.description||""}</textarea>\n            </div>\n            \n            <div class="form-field">\n              <label>Badge (${lang.code.toUpperCase()})</label>\n              <input type="text" \n                     name="badge_${lang.code}" \n                     value="${data?.badge_i18n?.[lang.code]||"pl"===lang.code&&data?.badge||""}"\n                     placeholder="e.g., Beach Explorer, Mountain Hiker">\n            </div>\n          </div>\n        `).join("")}\n      </div>\n      \n      <input type="hidden" name="id" value="${data?.id||""}">\n      \n      <div class="form-actions">\n        <button type="button" class="btn-secondary" onclick="closePoiI18nForm()">\n          Cancel\n        </button>\n        <button type="submit" class="btn-primary">\n          ðŸ’¾ Save POI\n        </button>\n      </div>\n    </form>\n  `}function closePoiI18nForm(){const container=document.getElementById("poiFormContainer");container&&(container.innerHTML="",container.style.display="none")}window.renderPOII18nForm=renderPOII18nForm,window.switchPoiLangTab=function(langCode){document.querySelectorAll(".lang-tab").forEach(btn=>{btn.classList.toggle("active",btn.dataset.lang===langCode)}),document.querySelectorAll(".lang-content").forEach(div=>{div.classList.toggle("active",div.dataset.lang===langCode)})},window.schedulePoiAutoSave=function(){clearTimeout(poiAutoSaveTimer),poiAutoSaveTimer=setTimeout(()=>{const form=document.getElementById("poiI18nForm");if(!form)return;const formData=new FormData(form),draft={id:formData.get("id"),lat:formData.get("lat"),lng:formData.get("lng"),xp:formData.get("xp"),radius:formData.get("radius"),status:formData.get("status"),google_url:formData.get("google_url"),name_i18n:{},description_i18n:{},badge_i18n:{},savedAt:(new Date).toISOString()};["pl","en","el","he"].forEach(lang=>{const name=formData.get(`name_${lang}`),desc=formData.get(`description_${lang}`),badge=formData.get(`badge_${lang}`);name&&(draft.name_i18n[lang]=name.trim()),desc&&(draft.description_i18n[lang]=desc.trim()),badge&&(draft.badge_i18n[lang]=badge.trim())});const draftKey=`poi_draft_${draft.id||"new"}`;localStorage.setItem(draftKey,JSON.stringify(draft))},2e3)},window.clearPoiDraft=function(key){localStorage.removeItem(key),showToast("Draft cleared","info"),closePoiI18nForm()},window.handlePOII18nSubmit=async function(event){event.preventDefault();const formData=new FormData(event.target),payload={lat:parseFloat(formData.get("lat")),lng:parseFloat(formData.get("lng")),xp:parseInt(formData.get("xp"))||100,radius:parseInt(formData.get("radius"))||500,status:formData.get("status")||"published",google_url:formData.get("google_url")||null,name_i18n:{},description_i18n:{},badge_i18n:{}};if(["pl","en","el","he"].forEach(lang=>{const name=formData.get(`name_${lang}`),desc=formData.get(`description_${lang}`),badge=formData.get(`badge_${lang}`);name&&name.trim()&&(payload.name_i18n[lang]=name.trim()),desc&&desc.trim()&&(payload.description_i18n[lang]=desc.trim()),badge&&badge.trim()&&(payload.badge_i18n[lang]=badge.trim())}),payload.name_i18n.pl&&payload.name_i18n.en)if(payload.description_i18n.pl&&payload.description_i18n.en){payload.name=payload.name_i18n.pl,payload.description=payload.description_i18n.pl,payload.badge=payload.badge_i18n.pl||"Explorer";try{const sb=ensureSupabase();if(!sb)throw new Error("Supabase not available");const poiId=formData.get("id");let result;if(poiId){const{data:data,error:error}=await sb.from("pois").update(payload).eq("id",poiId).select().single();if(error)throw error;result=data,showToast("âœ… POI zaktualizowane pomyÅ›lnie!","success")}else{const{data:data,error:error}=await sb.from("pois").insert(payload).select().single();if(error)throw error;result=data,showToast("âœ… POI utworzone pomyÅ›lnie!","success")}localStorage.removeItem(`poi_draft_${poiId||"new"}`),await loadPoisData(!0),closePoiI18nForm()}catch(err){console.error("Save error:",err),showToast(`âŒ BÅ‚Ä…d zapisu: ${err.message}`,"error")}}else showToast("Opis wymagany w jÄ™zyku polskim i angielskim!","error");else showToast("Nazwa wymagana w jÄ™zyku polskim i angielskim!","error")},window.openPoiI18nForm=function(poiId=null){let poi=null;poiId&&(poi=adminState.pois.find(p=>p.id===poiId));const container=document.getElementById("poiFormContainer");container?(container.innerHTML=renderPOII18nForm(poi),container.style.display="block",container.scrollIntoView({behavior:"smooth"})):console.error("POI form container not found")},window.closePoiI18nForm=closePoiI18nForm;