!function(){function isNonEmptyString(value){return"string"==typeof value&&value.trim().length>0}function isFiniteNumber(value){return"number"==typeof value&&Number.isFinite(value)}function toNumberOrZero(value){const numeric=Number(value);return Number.isFinite(numeric)?numeric:0}function getI18n(){return"undefined"!=typeof window&&window.appI18n||null}function getCurrentLanguage(){const i18n=getI18n();return i18n&&i18n.language||"pl"}function translateText(key,fallback=""){if(!isNonEmptyString(key))return isNonEmptyString(fallback)?fallback:"";const entry=function(language){const i18n=getI18n();return i18n&&i18n.translations&&i18n.translations[language]||{}}(getCurrentLanguage())[key];let result=null;return"string"==typeof entry?result=entry:entry&&"object"==typeof entry&&("string"==typeof entry.text?result=entry.text:"string"==typeof entry.html&&(result=entry.html)),isNonEmptyString(result)||(result=fallback),isNonEmptyString(result)?result:""}function resolveText(entry,fallback=""){return entry&&"object"==typeof entry?translateText(isNonEmptyString(entry.key)?entry.key:"",isNonEmptyString(entry.fallback)?entry.fallback:fallback):translateText("",fallback)}function wrapText(value,key){const entry=function(value){return value?"string"==typeof value?{key:"",fallback:value.trim()}:"object"==typeof value?{key:isNonEmptyString(value.key)?value.key.trim():isNonEmptyString(value.i18nKey)?value.i18nKey.trim():"",fallback:isNonEmptyString(value.fallback)?value.fallback.trim():isNonEmptyString(value.text)?value.text.trim():isNonEmptyString(value.default)?value.default.trim():""}:{key:"",fallback:""}:{key:"",fallback:""}}(value);return!isNonEmptyString(entry.key)&&isNonEmptyString(key)&&(entry.key=key),entry}function translateWithReplacements(key,fallback,replacements={}){return translateText(key,fallback).replace(/\{\{(\w+)\}\}/g,(match,param)=>Object.prototype.hasOwnProperty.call(replacements,param)?String(replacements[param]):match)}function getLocalizedFormatter(){const locale="en"===getCurrentLanguage()?"en-GB":"pl-PL";return new Intl.NumberFormat(locale,{style:"currency",currency:"EUR",maximumFractionDigits:0})}const config="undefined"!=typeof window&&window.CAR_RENTAL_CONFIG?window.CAR_RENTAL_CONFIG:{};"undefined"!=typeof window&&window.CAR_RENTAL_CONFIG&&delete window.CAR_RENTAL_CONFIG;const PRICING_TABLE=config.pricing&&"object"==typeof config.pricing&&!Array.isArray(config.pricing)?config.pricing:{"Toyota Yaris 2023":[150,40,37,35],"Nissan Note 2020":[150,40,37,35],"Kia Rio 2019":[150,40,37,35],"Toyota Yaris Hybrid 2023":[165,45,42,40],"Honda Fit 2022":[165,45,42,40],"Toyota Aqua Hybrid 2022":[165,45,42,40],"Honda Fit Hybrid 2019":[165,45,42,40],"Honda Fit Hybrid 2022":[165,45,42,40],"Nissan Note Hybrid 2023":[165,45,42,40]},carFleet=(Array.isArray(config.fleet)&&config.fleet.length?config.fleet:[{id:"toyota-yaris-2023",name:"Toyota Yaris",year:2023,pricingKey:"Toyota Yaris 2023",pricePerDay:35,seats:4,transmission:"Automat",category:"Hatchback miejski",fuel:"Benzyna",specs:["Automat","4 os.","AC","Ekonomiczny"],features:["Bez kaucji","Dodatkowy kierowca 0 €","1 € dziennie na ochronę żółwi"],note:"Nowa generacja hatchbacka idealna do zwiedzania całego Cypru.",image:{dataSrc:"assets/fleet/toyota-yaris-2023.jpg"}},{id:"nissan-note-2020",name:"Nissan Note",year:2020,pricingKey:"Nissan Note 2020",pricePerDay:35,seats:4,transmission:"Automat",category:"Hatchback miejski",fuel:"Benzyna",specs:["Automat","4 os.","AC","Przestronny"],features:["Bez kaucji","Polska obsługa 24/7","Foteliki w cenie"],note:"Wysoki dach zwiększa komfort podróży przy zachowaniu kompaktowych wymiarów.",image:{dataSrc:"assets/fleet/nissan-note-2020.jpg"}},{id:"kia-rio-2019",name:"Kia Rio",year:2019,pricingKey:"Kia Rio 2019",pricePerDay:35,seats:4,transmission:"Automat",category:"Hatchback miejski",fuel:"Benzyna",specs:["Automat","4 os.","AC","Ekonomiczny"],features:["Bez kaucji","Dodatkowy kierowca 0 €","Wsparcie 24/7"],note:"Zwrotna Kia idealna na miejskie uliczki i jednodniowe wycieczki.",image:{dataSrc:"assets/fleet/kia-rio-2019.jpg"}},{id:"toyota-yaris-hybrid-2023",name:"Toyota Yaris Hybrid",year:2023,pricingKey:"Toyota Yaris Hybrid 2023",pricePerDay:40,seats:4,transmission:"Automat",category:"Hybryda miejska",fuel:"Hybryda",specs:["Automat","4 os.","AC","Hybryda"],features:["Tryb EV w mieście","Dodatkowy kierowca 0 €","1 € na żółwie dziennie"],note:"Napęd hybrydowy zapewnia niskie spalanie podczas podróży po wyspie.",image:{dataSrc:"assets/fleet/toyota-yaris-hybrid-2023.jpg"}},{id:"honda-fit-2022",name:"Honda Fit",year:2022,pricingKey:"Honda Fit 2022",pricePerDay:40,seats:4,transmission:"Automat",category:"Kompakt rodzinny",fuel:"Benzyna",specs:["Automat","4 os.","AC","Przestronny"],features:["Magic Seats","Bez kaucji","Foteliki w cenie"],note:"Wszechstronne wnętrze pozwala łatwo przewozić bagaże i sprzęt plażowy.",image:{dataSrc:"assets/fleet/honda-fit-2022.jpg"}},{id:"toyota-aqua-hybrid-2022",name:"Toyota Aqua Hybrid",year:2022,pricingKey:"Toyota Aqua Hybrid 2022",pricePerDay:40,seats:5,transmission:"Automat",category:"Hybryda",fuel:"Hybryda",specs:["Automat","5 os.","AC","Hybryda"],features:["Bez kaucji","Niskie spalanie","Pomoc drogowa 24/7"],note:"Pięć miejsc i hybrydowy napęd sprawdzą się przy rodzinnych podróżach.",image:{dataSrc:"assets/fleet/toyota-aqua-hybrid-2022.jpg"}},{id:"honda-fit-hybrid-2019",name:"Honda Fit Hybrid",year:2019,pricingKey:"Honda Fit Hybrid 2019",pricePerDay:40,seats:4,transmission:"Automat",category:"Hybryda miejska",fuel:"Hybryda",specs:["Automat","4 os.","AC","Hybryda"],features:["Bez kaucji","Dodatkowy kierowca 0 €","Ekonomiczny napęd"],note:"Sprawdzona hybryda z kompaktowym nadwoziem i pełnym pakietem w cenie.",image:{dataSrc:"assets/fleet/honda-fit-hybrid-2019.jpg"}},{id:"honda-fit-hybrid-2022",name:"Honda Fit Hybrid",year:2022,pricingKey:"Honda Fit Hybrid 2022",pricePerDay:40,seats:4,transmission:"Automat",category:"Hybryda miejska",fuel:"Hybryda",specs:["Automat","4 os.","AC","Hybryda"],features:["Najwyższy poziom bezpieczeństwa","Foteliki gratis","1 € dziennie na żółwie"],note:"Najmłodsza generacja Fit Hybrid łączy oszczędność z nowoczesnymi systemami.",image:{dataSrc:"assets/fleet/honda-fit-hybrid-2022.jpg"}},{id:"nissan-note-hybrid-2023",name:"Nissan Note Hybrid",year:2023,pricingKey:"Nissan Note Hybrid 2023",pricePerDay:40,seats:4,transmission:"Automat",category:"Hybryda miejska",fuel:"Hybryda",specs:["Automat","4 os.","AC","Hybryda"],features:["System e-Power","Bez kaucji","Polska obsługa 24/7"],note:"Dynamiczny napęd e-Power i kompaktowe nadwozie idealne na cypryjskie drogi.",image:{dataSrc:"assets/fleet/nissan-note-hybrid-2023.jpg"}}]).map(car=>{const id=isNonEmptyString(car.id)?car.id.trim():"",transmissionKey=id?`carRental.fleet.${id}.transmission`:"",categoryKey=id?`carRental.fleet.${id}.category`:"",fuelKey=id?`carRental.fleet.${id}.fuel`:"",features=Array.isArray(car.features)?car.features.map((feature,index)=>wrapText(feature,id?`carRental.fleet.${id}.feature${index+1}`:"")):[],specs=Array.isArray(car.specs)?car.specs.map((spec,index)=>wrapText(spec,id?`carRental.fleet.${id}.spec${index+1}`:"")):[],pricingKey=isNonEmptyString(car.pricingKey)?car.pricingKey.trim():[car.name,car.year].filter(value=>isNonEmptyString(value)).join(" ").trim(),displayName=isNonEmptyString(car.displayName)?car.displayName.trim():pricingKey||[car.name,car.year].filter(value=>isNonEmptyString(value)).join(" ").trim();return{...car,id:id,transmission:wrapText(car.transmission,transmissionKey),category:wrapText(car.category,categoryKey),fuel:wrapText(car.fuel,fuelKey),features:features,specs:specs,note:wrapText(car.note,id?`carRental.fleet.${id}.note`:""),pricePerDay:isFiniteNumber(car.pricePerDay)?car.pricePerDay:toNumberOrZero(car.pricePerDay),pricingKey:pricingKey,displayName:displayName}}),rentalLocations=(Array.isArray(config.locations)&&config.locations.length?config.locations:[{id:"larnaca",label:"Larnaka (bez opłaty)",shortLabel:"Larnaka",fee:0},{id:"nicosia",label:"Nikozja (+15€)",shortLabel:"Nikozja",fee:15},{id:"ayia-napa",label:"Ayia Napa (+15€)",shortLabel:"Ayia Napa",fee:15},{id:"protaras",label:"Protaras (+20€)",shortLabel:"Protaras",fee:20},{id:"limassol",label:"Limassol (+20€)",shortLabel:"Limassol",fee:20},{id:"paphos",label:"Pafos (+40€)",shortLabel:"Pafos",fee:40}]).map(location=>{const id=isNonEmptyString(location.id)?location.id.trim():"",labelEntry=wrapText(location.label,id?`carRental.locations.${id}.label`:""),shortEntry=wrapText(location.shortLabel,id?`carRental.locations.${id}.short`:""),shortFallback=isNonEmptyString(shortEntry.fallback)?shortEntry.fallback:isNonEmptyString(labelEntry.fallback)?labelEntry.fallback:"";return!isNonEmptyString(shortEntry.fallback)&&shortFallback&&(shortEntry.fallback=shortFallback),{...location,id:id,label:labelEntry,shortLabel:shortEntry,fee:isFiniteNumber(location.fee)?location.fee:toNumberOrZero(location.fee)}}),PRICE_CATEGORIES=(Array.isArray(config.priceCategories)&&config.priceCategories.length?config.priceCategories:[{id:"economy",label:"Ekonomiczne automaty",badge:"od 35 €/dzień",description:"Kompaktowe auta miejskie bez kaucji – idealne na start przygody na Cyprze.",min:0,max:35},{id:"hybrid",label:"Hybrydy i komfort",badge:"od 40 €/dzień",description:"Oszczędne napędy hybrydowe z klimatyzacją i pakietem rodzinnych dodatków.",min:36,max:45}]).map(category=>{const id=isNonEmptyString(category.id)?category.id.trim():"";return{...category,id:id,label:wrapText(category.label,id?`carRental.categories.${id}.label`:""),badge:wrapText(category.badge,id?`carRental.categories.${id}.badge`:""),description:wrapText(category.description,id?`carRental.categories.${id}.description`:"")}}),RENTAL_INCLUDED_FEATURES=(Array.isArray(config.includedFeatures)&&config.includedFeatures.length?config.includedFeatures:[{short:"Brak kaucji",description:"Brak kaucji i blokad na karcie przy każdym wynajmie."},{short:"OC + pomoc 24/7",description:"Ubezpieczenie OC z udziałem własnym do 500 € oraz całodobowa pomoc drogowa."},{short:"Dodatkowy kierowca",description:"Drugi kierowca wpisany do umowy w cenie – bez dopłat."},{short:"Foteliki gratis",description:"Foteliki i podkładki dla dzieci udostępniamy za 0 €."},{short:"1 € na ochronę żółwi",description:"Każdego dnia przeznaczamy 1 € na ochronę cypryjskich żółwi morskich."}]).map((feature,index)=>({short:wrapText(feature.short,`carRental.included.feature${index+1}.short`),description:wrapText(feature.description,`carRental.included.feature${index+1}.description`)})),RENTAL_MINIMUM_DAYS=isFiniteNumber(config.minimumDays)?config.minimumDays:3,FULL_INSURANCE_DAILY=isFiniteNumber(config.fullInsuranceDaily)?config.fullInsuranceDaily:17,YOUNG_DRIVER_DAILY=isFiniteNumber(config.youngDriverDaily)?config.youngDriverDaily:10,includedMessageEntry=wrapText(isNonEmptyString(config.includedMessage)||isNonEmptyString(config.includedMessageKey)?{key:isNonEmptyString(config.includedMessageKey)?config.includedMessageKey.trim():"",fallback:isNonEmptyString(config.includedMessage)?config.includedMessage.trim():""}:null,"");let EURO_FORMATTER=getLocalizedFormatter(),rentalContext=null;function formatPrice(value){return EURO_FORMATTER.format(value)}function formatPricePerDay(value){const price=formatPrice(value).replace(/\u00a0/g," ");return translateWithReplacements("carRental.common.pricePerDayFrom",`od ${price}/dzień`,{price:price})}function getDaysLabel(){return translateText("carRental.common.daysLabel","dni")}function getIncludedMessage(){if(isNonEmptyString(includedMessageEntry.key)||isNonEmptyString(includedMessageEntry.fallback))return resolveText(includedMessageEntry);const items=RENTAL_INCLUDED_FEATURES.map(feature=>resolveText(feature.short)).filter(text=>isNonEmptyString(text));return items.length?translateWithReplacements("carRental.common.includedMessage.template",`W cenie: ${items.join(", ")}.`,{items:items.join(", ")}):""}function populateIncludedFeatures(){document.querySelectorAll("[data-included-list]").forEach(list=>{list.innerHTML="",RENTAL_INCLUDED_FEATURES.forEach(feature=>{const item=document.createElement("li");item.textContent=resolveText(feature.description),list.appendChild(item)})})}function getRentalLocationById(locationId){return locationId&&rentalLocations.find(location=>location.id===locationId)||null}function populateCarSelect(selectOrSelectedValue,maybeSelectedValue){const isElement=!(!(value=selectOrSelectedValue)||"object"!=typeof value)&&("undefined"!=typeof HTMLSelectElement&&value instanceof HTMLSelectElement||"string"==typeof value.tagName&&"select"===value.tagName.toLowerCase());var value;const targetSelect=isElement?selectOrSelectedValue:document.getElementById("rentalCarSelect");targetSelect&&function(select,selectedValue){if(!select)return;select.innerHTML="",carFleet.forEach(car=>{const option=document.createElement("option");option.value=car.id;const pricePerDay=formatPricePerDay(car.pricePerDay),nameParts=[];isNonEmptyString(car.displayName)?nameParts.push(car.displayName):(nameParts.push(car.name),car.year&&nameParts.push(car.year)),option.dataset.pricingKey=car.pricingKey,option.textContent=`${nameParts.filter(Boolean).join(" ")} — ${pricePerDay}`,select.appendChild(option)});const desiredValue=selectedValue&&carFleet.some(car=>car.id===selectedValue)?selectedValue:null;desiredValue?select.value=desiredValue:carFleet.length&&(select.value=carFleet[0].id)}(targetSelect,isElement?maybeSelectedValue:selectOrSelectedValue)}function populateLocationSelect(select,selectedValue){select&&function(selects,selectedValues=[]){selects.filter(Boolean).forEach((select,index)=>{select.innerHTML="",rentalLocations.forEach(location=>{const option=document.createElement("option");option.value=location.id,option.textContent=resolveText(location.label),select.appendChild(option)});const preferredValue=Array.isArray(selectedValues)&&selectedValues[index]&&rentalLocations.some(loc=>loc.id===selectedValues[index])?selectedValues[index]:null;preferredValue?select.value=preferredValue:rentalLocations.length&&(select.value=rentalLocations[0].id)})}([select],"string"==typeof selectedValue&&selectedValue?[selectedValue]:Array.isArray(selectedValue)?selectedValue.filter(Boolean):[])}function initDatePickers(pickupDateInput,returnDateInput){!function(pickupDateInput,returnDateInput){if(!pickupDateInput||!returnDateInput)return;const today=new Date,isoToday=today.toISOString().split("T")[0];pickupDateInput.value=isoToday,pickupDateInput.min=isoToday;const minimumReturn=new Date(today);minimumReturn.setDate(minimumReturn.getDate()+RENTAL_MINIMUM_DAYS);const isoReturn=minimumReturn.toISOString().split("T")[0];returnDateInput.value=isoReturn,returnDateInput.min=isoToday}(pickupDateInput,returnDateInput),function(pickupDateInput,returnDateInput){pickupDateInput&&returnDateInput&&pickupDateInput.addEventListener("change",()=>{if(!pickupDateInput.value)return;const newMin=pickupDateInput.value;returnDateInput.min=newMin,returnDateInput.value&&returnDateInput.value<newMin&&(returnDateInput.value=newMin)})}(pickupDateInput,returnDateInput)}function updateRentalQuote(context){const{carSelect:carSelect,pickupDateInput:pickupDateInput,pickupTimeInput:pickupTimeInput,returnDateInput:returnDateInput,returnTimeInput:returnTimeInput,pickupSelect:pickupSelect,returnSelect:returnSelect,fullInsuranceCheckbox:fullInsuranceCheckbox,youngDriverCheckbox:youngDriverCheckbox,resultEl:resultEl,breakdownEl:breakdownEl,messageEl:messageEl}=context;if(!(carSelect&&pickupDateInput&&returnDateInput&&pickupTimeInput&&returnTimeInput&&pickupSelect&&returnSelect&&resultEl&&breakdownEl&&messageEl))return!1;const car=(carId=carSelect.value)&&carFleet.find(car=>car.id===carId)||null;var carId;if(!car)return setRentalError(translateText("carRental.calculator.errors.selectCar","Wybierz model auta z listy."));if(!pickupDateInput.value||!returnDateInput.value)return setRentalError(translateText("carRental.calculator.errors.fillDates","Uzupełnij daty odbioru i zwrotu."));const pickupTime=pickupTimeInput.value||"00:00",returnTime=returnTimeInput.value||"00:00",pickupDate=new Date(`${pickupDateInput.value}T${pickupTime}`),returnDate=new Date(`${returnDateInput.value}T${returnTime}`);if(Number.isNaN(pickupDate.getTime())||Number.isNaN(returnDate.getTime()))return setRentalError(translateText("carRental.calculator.errors.invalidDates","Proszę wybrać poprawne daty i godziny."));if(returnDate<=pickupDate)return setRentalError(translateText("carRental.calculator.errors.returnAfterPickup","Data zwrotu musi być późniejsza niż data odbioru."));const diffHours=(returnDate.getTime()-pickupDate.getTime())/36e5,rentalDays=Math.ceil(diffHours/24);if(rentalDays<RENTAL_MINIMUM_DAYS)return setRentalError(translateWithReplacements("carRental.calculator.errors.minimumDays","Minimalny czas wynajmu to {{days}} {{daysLabel}}.",{days:RENTAL_MINIMUM_DAYS,daysLabel:getDaysLabel()}));const pickupLocation=getRentalLocationById(pickupSelect.value),returnLocation=getRentalLocationById(returnSelect.value);if(!pickupLocation||!returnLocation)return setRentalError(translateText("carRental.calculator.errors.selectLocations","Wybierz miejsca odbioru i zwrotu pojazdu."));const pricingRow=PRICING_TABLE[car.pricingKey]||PRICING_TABLE[car.displayName]||PRICING_TABLE[car.name];if(!pricingRow)return setRentalError(translateText("carRental.calculator.errors.missingPricing","Brak cennika dla wybranego modelu – skontaktuj się z obsługą."));let basePrice=0,dailyRate=0;3===rentalDays?basePrice=pricingRow[0]:rentalDays>=4&&rentalDays<=6?(dailyRate=pricingRow[1],basePrice=dailyRate*rentalDays):rentalDays>=7&&rentalDays<=10?(dailyRate=pricingRow[2],basePrice=dailyRate*rentalDays):(dailyRate=pricingRow[3],basePrice=dailyRate*rentalDays);const pickupFee=pickupLocation.fee,returnFee=returnLocation.fee,insuranceCost=fullInsuranceCheckbox?.checked?FULL_INSURANCE_DAILY*rentalDays:0,youngDriverCost=youngDriverCheckbox?.checked?YOUNG_DRIVER_DAILY*rentalDays:0,totalPrice=basePrice+pickupFee+returnFee+insuranceCost+youngDriverCost,daysLabel=getDaysLabel(),pickupLocationLabel=resolveText(pickupLocation.shortLabel),returnLocationLabel=resolveText(returnLocation.shortLabel),breakdownItems=[];if(3===rentalDays)breakdownItems.push(translateWithReplacements("carRental.calculator.breakdown.package3",`Pakiet 3 dni: ${formatPrice(basePrice)}`,{total:formatPrice(basePrice)}));else{const rateFormatted=formatPrice(dailyRate);breakdownItems.push(translateWithReplacements("carRental.calculator.breakdown.tiered",`${rateFormatted} × ${rentalDays} ${daysLabel} = ${formatPrice(basePrice)}`,{pricePerDay:rateFormatted,days:rentalDays,daysLabel:daysLabel,total:formatPrice(basePrice)}))}breakdownItems.push(pickupFee>0?translateWithReplacements("carRental.calculator.breakdown.pickupWithFee",`Odbiór: ${pickupLocationLabel} +${formatPrice(pickupFee)}`,{location:pickupLocationLabel,price:formatPrice(pickupFee)}):translateWithReplacements("carRental.calculator.breakdown.pickupIncluded",`Odbiór: ${pickupLocationLabel} – w cenie`,{location:pickupLocationLabel})),breakdownItems.push(returnFee>0?translateWithReplacements("carRental.calculator.breakdown.returnWithFee",`Zwrot: ${returnLocationLabel} +${formatPrice(returnFee)}`,{location:returnLocationLabel,price:formatPrice(returnFee)}):translateWithReplacements("carRental.calculator.breakdown.returnIncluded",`Zwrot: ${returnLocationLabel} – w cenie`,{location:returnLocationLabel})),insuranceCost>0&&breakdownItems.push(translateWithReplacements("carRental.calculator.breakdown.fullInsurance",`Pełne AC: ${formatPrice(FULL_INSURANCE_DAILY)} × ${rentalDays} ${daysLabel} = ${formatPrice(insuranceCost)}`,{pricePerDay:formatPrice(FULL_INSURANCE_DAILY),days:rentalDays,daysLabel:daysLabel,total:formatPrice(insuranceCost)})),youngDriverCost>0&&breakdownItems.push(translateWithReplacements("carRental.calculator.breakdown.youngDriver",`Młody kierowca: ${formatPrice(YOUNG_DRIVER_DAILY)} × ${rentalDays} ${daysLabel} = ${formatPrice(youngDriverCost)}`,{pricePerDay:formatPrice(YOUNG_DRIVER_DAILY),days:rentalDays,daysLabel:daysLabel,total:formatPrice(youngDriverCost)})),resultEl.textContent=translateWithReplacements("carRental.calculator.total",`Całkowita cena wynajmu: ${formatPrice(totalPrice)}`,{price:formatPrice(totalPrice)});const breakdownTitle=translateText("carRental.calculator.breakdown.title","Wycena obejmuje:");return breakdownEl.innerHTML=`<p>${breakdownTitle}</p><ul>${breakdownItems.map(item=>`<li>${item}</li>`).join("")}</ul>`,messageEl.textContent=getIncludedMessage(),messageEl.classList.remove("is-error"),!0;function setRentalError(message){return resultEl.dataset?.fallbackTotal?resultEl.textContent=resultEl.dataset.fallbackTotal:resultEl.textContent="",breakdownEl.innerHTML="",messageEl.textContent=message,messageEl.classList.add("is-error"),!1}}function renderCarFleet(grid,context){if(!grid)return;grid.innerHTML="";const language=getCurrentLanguage(),sortedFleet=carFleet.slice().sort((a,b)=>{if(a.pricePerDay===b.pricePerDay){const nameA=(a.displayName||a.name||"").toString(),nameB=(b.displayName||b.name||"").toString();return nameA.localeCompare(nameB,language)}return a.pricePerDay-b.pricePerDay}),groups=PRICE_CATEGORIES.map(category=>({...category,labelText:resolveText(category.label),descriptionText:resolveText(category.description),badgeText:resolveText(category.badge),cars:[]}));sortedFleet.forEach(car=>{(groups.find(group=>car.pricePerDay>=group.min&&car.pricePerDay<=group.max)||groups[groups.length-1]).cars.push(car)}),groups.filter(group=>group.cars.length>0).forEach(group=>{const groupSection=document.createElement("article");groupSection.className="auto-category",groupSection.id=`auto-category-${group.id}`;const groupHeader=document.createElement("header");groupHeader.className="auto-category-header";const title=document.createElement("div");title.className="auto-category-title";const heading=document.createElement("h3");heading.textContent=group.labelText;const description=document.createElement("p");description.textContent=group.descriptionText,title.appendChild(heading),title.appendChild(description);const badge=document.createElement("span");badge.className="auto-category-badge",badge.textContent=group.badgeText,groupHeader.appendChild(title),groupHeader.appendChild(badge);const list=document.createElement("div");list.className="auto-category-grid",group.cars.forEach(car=>{list.appendChild(function(car,context){const card=document.createElement("article");card.className="auto-card";const imageWrapper=document.createElement("div");imageWrapper.className="auto-card-media";const image=document.createElement("img");image.loading="lazy",image.src='data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 3" preserveAspectRatio="xMidYMid slice"%3E%3Crect width="4" height="3" fill="%23e2e8f0"/%3E%3C/svg%3E',car.image&&"object"==typeof car.image&&(isNonEmptyString(car.image.src)&&(image.src=car.image.src),isNonEmptyString(car.image.dataSrc)&&(image.dataset.src=car.image.dataSrc),isNonEmptyString(car.image.alt)&&(image.alt=car.image.alt)),image.alt||(image.alt=`${car.displayName||car.name}`),imageWrapper.appendChild(image),card.appendChild(imageWrapper);const header=document.createElement("header");header.className="auto-card-header";const price=document.createElement("span");price.className="auto-card-price",price.textContent=formatPricePerDay(car.pricePerDay);const titleWrapper=document.createElement("div");titleWrapper.className="auto-card-title";const title=document.createElement("h3");title.textContent=car.displayName||car.name;const subtitle=document.createElement("span"),categoryText=resolveText(car.category),details=[];car.year&&!String(title.textContent).includes(String(car.year))&&details.push(car.year),categoryText&&details.push(categoryText),subtitle.textContent=details.join(" • "),title.appendChild(subtitle),titleWrapper.appendChild(title),header.appendChild(price),header.appendChild(titleWrapper),card.appendChild(header);const specs=document.createElement("ul");var count;if(specs.className="auto-card-specs",(car.specs?.length?car.specs.map(spec=>resolveText(spec)):[(count=car.seats,translateWithReplacements("carRental.common.seats",`${count} os.`,{count:count})),resolveText(car.transmission),resolveText(car.fuel)].filter(value=>isNonEmptyString(value))).forEach(value=>{const item=document.createElement("li");item.textContent=value,specs.appendChild(item)}),card.appendChild(specs),car.features?.length){const featuresList=document.createElement("ul");featuresList.className="auto-card-tags",car.features.forEach(feature=>{const li=document.createElement("li");li.textContent=resolveText(feature),featuresList.appendChild(li)}),card.appendChild(featuresList)}if(car.note){const note=document.createElement("p");note.className="auto-card-note",note.textContent=resolveText(car.note),card.appendChild(note)}const button=document.createElement("button");return button.type="button",button.className="secondary",button.textContent=translateText("carRental.common.reserveCar","Zarezerwuj to auto"),button.addEventListener("click",()=>{context.carSelect&&(context.carSelect.value=car.id,context.carSelect.dispatchEvent(new Event("change",{bubbles:!0}))),updateRentalQuote(context);const calculatorBlock=document.getElementById("carRentalCalculatorBlock");calculatorBlock&&calculatorBlock.scrollIntoView({behavior:"smooth",block:"start"}),context.carSelect&&context.carSelect.focus({preventScroll:!0})}),card.appendChild(button),card}(car,context))}),groupSection.appendChild(groupHeader),groupSection.appendChild(list),grid.appendChild(groupSection)})}document.addEventListener("wakacjecypr:languagechange",function(){if(EURO_FORMATTER=getLocalizedFormatter(),populateIncludedFeatures(),!rentalContext)return;const{carSelect:carSelect,pickupSelect:pickupSelect,returnSelect:returnSelect,grid:grid}=rentalContext,selectedCar=carSelect?.value,selectedPickup=pickupSelect?.value,selectedReturn=returnSelect?.value;populateCarSelect(carSelect,selectedCar),populateLocationSelect(pickupSelect,selectedPickup),populateLocationSelect(returnSelect,selectedReturn),renderCarFleet(grid,rentalContext),updateRentalQuote(rentalContext)}),window.CarRental={initializeSection:function(){const carSelect=document.getElementById("rentalCarSelect"),pickupSelect=document.getElementById("pickupLocation"),returnSelect=document.getElementById("returnLocation"),pickupDateInput=document.getElementById("pickupDate"),returnDateInput=document.getElementById("returnDate"),pickupTimeInput=document.getElementById("pickupTime"),returnTimeInput=document.getElementById("returnTime"),fullInsuranceCheckbox=document.getElementById("fullInsurance"),youngDriverCheckbox=document.getElementById("youngDriver"),resultEl=document.getElementById("carRentalResult"),breakdownEl=document.getElementById("carRentalBreakdown"),messageEl=document.getElementById("carRentalMessage"),form=document.getElementById("carRentalCalculator"),grid=document.getElementById("carRentalGrid");if(!(carSelect&&pickupSelect&&returnSelect&&pickupDateInput&&returnDateInput&&pickupTimeInput&&returnTimeInput&&resultEl&&breakdownEl&&messageEl&&form&&grid))return;populateIncludedFeatures();const context={carSelect:carSelect,pickupDateInput:pickupDateInput,pickupTimeInput:pickupTimeInput,returnDateInput:returnDateInput,returnTimeInput:returnTimeInput,pickupSelect:pickupSelect,returnSelect:returnSelect,fullInsuranceCheckbox:fullInsuranceCheckbox,youngDriverCheckbox:youngDriverCheckbox,resultEl:resultEl,breakdownEl:breakdownEl,messageEl:messageEl,grid:grid};rentalContext=context;const fallbackCar=carFleet[0];if(fallbackCar&&resultEl){const fallbackEstimate=formatPrice(toNumberOrZero(fallbackCar.pricePerDay)*RENTAL_MINIMUM_DAYS),fallbackText=translateWithReplacements("carRental.calculator.total",`Całkowita cena wynajmu: ${fallbackEstimate}`,{price:fallbackEstimate});resultEl.dataset.fallbackTotal=fallbackText,isNonEmptyString(resultEl.textContent)||(resultEl.textContent=fallbackText)}try{populateCarSelect(carSelect),populateLocationSelect(pickupSelect),populateLocationSelect(returnSelect),initDatePickers(pickupDateInput,returnDateInput)}catch(error){console.error("Car rental calculator initialization failed",error)}carFleet.length&&(carSelect.value=carFleet[0].id),renderCarFleet(grid,context),updateRentalQuote(context),form.addEventListener("submit",event=>{event.preventDefault(),updateRentalQuote(context)}),form.addEventListener("change",()=>{messageEl.classList.remove("is-error"),updateRentalQuote(context)})},getFleet:()=>carFleet.map(car=>({...car,transmission:resolveText(car.transmission),category:resolveText(car.category),fuel:resolveText(car.fuel),specs:Array.isArray(car.specs)?car.specs.map(spec=>resolveText(spec)):[],features:Array.isArray(car.features)?car.features.map(feature=>resolveText(feature)):[],note:resolveText(car.note)})),getRentalLocations:()=>rentalLocations.map(location=>({...location,label:resolveText(location.label),shortLabel:resolveText(location.shortLabel)})),formatPrice:formatPrice,getIncludedMessage:getIncludedMessage,minimumDays:RENTAL_MINIMUM_DAYS,populateCarSelect:populateCarSelect,populateLocationSelect:populateLocationSelect,initDatePickers:initDatePickers}}();