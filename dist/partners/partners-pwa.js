let deferredPrompt=null,notifyInstallUi=null;function isIos(){const ua=navigator.userAgent||"";return/iphone|ipad|ipod/i.test(ua)}function showUpdateBanner(registration){(function(){let banner=document.getElementById("partnerPwaUpdateBanner");return banner||(banner=document.createElement("div"),banner.id="partnerPwaUpdateBanner",banner.className="admin-pwa-update-banner",banner.hidden=!0,banner.innerHTML='\n    <div class="admin-pwa-update-banner__inner">\n      <div class="admin-pwa-update-banner__text">Update available</div>\n      <button type="button" class="btn-secondary admin-pwa-update-banner__btn" id="partnerPwaReloadBtn">Reload</button>\n    </div>\n  ',document.body.appendChild(banner),banner)}()).hidden=!1;const btn=document.getElementById("partnerPwaReloadBtn");btn&&!btn.dataset.bound&&(btn.dataset.bound="true",btn.addEventListener("click",async()=>{try{const waiting=registration?.waiting;waiting&&waiting.postMessage({type:"SKIP_WAITING"})}catch(_e){}window.location.reload()}))}window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),deferredPrompt=e,"function"==typeof notifyInstallUi&&notifyInstallUi()}),window.addEventListener("appinstalled",()=>{deferredPrompt=null,"function"==typeof notifyInstallUi&&notifyInstallUi()}),function bootPartnersPwa(){"loading"!==document.readyState?(function(){const installBtn=document.getElementById("btnPartnerInstallApp"),hintEl=document.getElementById("partnerInstallHint"),statusEl=document.getElementById("partnerInstallStatus"),toast=message=>{try{"function"==typeof window.showToast&&window.showToast(message,"info",6e3)}catch(_e){}},setStatus=text=>{statusEl&&(statusEl.textContent=text)},setHint=html=>{if(!hintEl)return;const v=String(html||"").trim();if(!v)return hintEl.hidden=!0,void(hintEl.innerHTML="");hintEl.hidden=!1,hintEl.innerHTML=v},updateUi=()=>window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||Boolean(navigator.standalone)?(installBtn&&(installBtn.hidden=!0),setHint(""),void setStatus("Installed")):isIos()?(installBtn&&(installBtn.hidden=!1),setStatus("Not installed"),void setHint("On iPhone: open in Safari, tap <strong>Share</strong> → <strong>Add to Home Screen</strong>. Then open the app from the Home Screen.")):(setStatus("Not installed"),installBtn&&(installBtn.hidden=!1),void setHint(deferredPrompt?"Tap <strong>Install</strong> to add this app to your device.":"Tap <strong>Install</strong>. If no prompt appears, use your browser menu (e.g. <strong>Install app</strong> / <strong>Add to Home screen</strong>)."));notifyInstallUi=updateUi,installBtn&&installBtn.addEventListener("click",async()=>{if(deferredPrompt){try{deferredPrompt.prompt(),await deferredPrompt.userChoice}catch(_e){}deferredPrompt=null,updateUi()}else{updateUi(),isIos()?toast("On iPhone: open in Safari → Share → Add to Home Screen."):toast("If no install prompt appears, use your browser menu: “Install app” / “Add to Home screen”.");try{hintEl&&hintEl.scrollIntoView({behavior:"smooth",block:"nearest"})}catch(_e){}}});try{const mql=window.matchMedia?window.matchMedia("(display-mode: standalone)"):null;mql&&"function"==typeof mql.addEventListener&&mql.addEventListener("change",updateUi)}catch(_e){}window.addEventListener("pageshow",updateUi),document.addEventListener("visibilitychange",()=>{document.hidden||updateUi()}),updateUi()}(),async function(){if(!("serviceWorker"in navigator))return null;if(!window.isSecureContext)return null;try{const registration=await navigator.serviceWorker.register("/partners/sw.js?v=20260216_3",{scope:"/partners/"});try{await registration.update()}catch(_e){}return registration.waiting&&showUpdateBanner(registration),registration.addEventListener("updatefound",()=>{const newWorker=registration.installing;newWorker&&newWorker.addEventListener("statechange",()=>{"installed"===newWorker.state&&navigator.serviceWorker.controller&&showUpdateBanner(registration)})}),navigator.serviceWorker.addEventListener("controllerchange",()=>{const banner=document.getElementById("partnerPwaUpdateBanner");banner&&(banner.hidden=!0)}),registration}catch(e){return null}}()):document.addEventListener("DOMContentLoaded",bootPartnersPwa)}();