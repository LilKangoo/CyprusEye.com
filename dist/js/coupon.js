!function(){const FALLBACK_POINTS={pl:["Bez kaucji / jasne warunki","24/7 wsparcie na miejscu","Odbiór w głównych miastach","Transparentna cena i zasady"],en:["No deposit / clear terms","24/7 local support","Pick-up in major cities","Transparent pricing & rules"],el:["Χωρίς εγγύηση / καθαροί όροι","Υποστήριξη 24/7","Παραλαβή σε μεγάλες πόλεις","Διαφανής τιμολόγηση & κανόνες"]};let redirecting=!1;function getLanguage(){const fromApp=window.appI18n?.language;if(fromApp)return fromApp;return new URLSearchParams(window.location.search).get("lang")||document.documentElement.lang||"pl"}function renderPoints(){const list=document.getElementById("couponPointsList");if(!list)return;const points=function(language){const entry=function(language){return(window.appI18n?.translations||{})[language]||{}}(language)["coupon.points"];return Array.isArray(entry)&&entry.length>0?entry:FALLBACK_POINTS[language]||FALLBACK_POINTS.en}(getLanguage());list.innerHTML="",points.forEach(point=>{const item=document.createElement("li");item.textContent=point,list.appendChild(item)})}function normalizeText(value){return value?value.toLocaleLowerCase("pl-PL").normalize("NFD").replace(/\p{Diacritic}/gu,""):""}function updateCouponSearchMeta(query,results){const meta=document.querySelector("[data-coupon-search-meta]"),queryLabel=document.querySelector("[data-coupon-query]"),resultsLabel=document.querySelector("[data-coupon-results]"),emptyState=document.querySelector("[data-coupon-empty]");meta&&(meta.hidden=!query),queryLabel&&(queryLabel.textContent=query),resultsLabel&&(resultsLabel.textContent=results.toString()),emptyState&&(emptyState.hidden=!(query&&0===results))}function applyOfferSearchFilter(){const cards=document.querySelectorAll("[data-coupon-offer]");if(!cards.length)return;const query=function(){const params=new URLSearchParams(window.location.search);return(params.get("coupon")||params.get("q")||"").trim()}(),normalizedQuery=normalizeText(query);!function(query){document.querySelectorAll("[data-coupon-search-input]").forEach(input=>{input&&input.value!==query&&(input.value=query)})}(query);let matches=0;cards.forEach(card=>{if(card.classList.remove("coupon-offer--highlight"),card.hidden=!1,!normalizedQuery)return;const isMatch=normalizeText(`${card.getAttribute("data-partner")||""} ${card.textContent}`).includes(normalizedQuery);card.hidden=!isMatch,isMatch&&(matches+=1,card.classList.add("coupon-offer--highlight"))}),normalizedQuery?updateCouponSearchMeta(query,matches):updateCouponSearchMeta("",cards.length)}function init(){const button=document.querySelector("[data-coupon-cta]");button&&button.addEventListener("click",function(event){event.preventDefault(),redirecting||(redirecting=!0,function(language){const tracker=window.track;if("function"==typeof tracker)try{const result=tracker("coupon_click_to_stripe",{lang:language,path:window.location.pathname});result&&"function"==typeof result.then&&result.catch(()=>{})}catch(error){}}(getLanguage()),window.location.href="https://buy.stripe.com/fZu8wPgtR5jsbhN22d0VO0E")}),renderPoints(),function(){const forms=document.querySelectorAll("[data-coupon-search-form]");forms.length&&forms.forEach(form=>{form.addEventListener("submit",event=>{event.preventDefault();const input=form.querySelector("[data-coupon-search-input]");!function(query){const params=new URLSearchParams(window.location.search);query?params.set("coupon",query):params.delete("coupon");const nextQuery=params.toString(),newUrl=nextQuery?`${window.location.pathname}?${nextQuery}`:window.location.pathname;window.history.replaceState({},"",newUrl)}(input?input.value.trim():""),applyOfferSearchFilter()})})}(),applyOfferSearchFilter()}document.addEventListener("wakacjecypr:languagechange",renderPoints),window.addEventListener("popstate",applyOfferSearchFilter),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",init,{once:!0}):init()}();