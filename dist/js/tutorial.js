!function(){const FOCUSABLE_SELECTORS=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");function safeLocalStorage(action,key,value){try{if("get"===action)return window.localStorage.getItem(key);"set"===action&&window.localStorage.setItem(key,value)}catch(error){}return null}function getTranslation(key,fallback){const i18n=window.appI18n||{},language=i18n.language||document.documentElement.lang||"pl",entry=(i18n.translations&&i18n.translations[language]||{})[key];if("string"==typeof entry)return entry;if(entry&&"object"==typeof entry){if("string"==typeof entry.text)return entry.text;if("string"==typeof entry.html)return entry.html}return fallback}function areTranslationsReady(){const i18n=window.appI18n||{},language=i18n.language||null;return Boolean(language&&i18n.translations&&i18n.translations[language])}const tutorialInstance=new class{constructor(){this.currentStepIndex=0,this.overlay=null,this.backdrop=null,this.highlight=null,this.arrowElement=null,this.dialog=null,this.titleEl=null,this.descriptionEl=null,this.prevButton=null,this.nextButton=null,this.skipButton=null,this.helpButton=null,this.activeTarget=null,this.previouslyFocusedElement=null,this.launchSource=null,this.isOpen=!1,this.initialized=!1,this.translationsReady=!1,this.hasAutoStarted=!1,this.pendingFrame=null,this.steps=[{id:"step1",target:'[data-tour-target="quick-actions"]',fallbackTitle:"Szybkie dziaÅ‚ania w nagÅ‚Ã³wku",fallbackDescription:"Skocz do aktualnego celu, otwÃ³rz wynajem auta, przeglÄ…daj atrakcje lub wezwij pomoc SOS jednym klikniÄ™ciem.",arrow:{icon:"â¬†ï¸",placement:"bottom"}},{id:"step2",target:'[data-tour-target="map-section"]',fallbackTitle:"Mapa z przyciskiem meldowania",fallbackDescription:"SprawdÅº interaktywnÄ… mapÄ™, zamelduj siÄ™ w aktualnym celu lub pomiÅ„ mapÄ™ za pomocÄ… linku dostÄ™pnoÅ›ci.",arrow:{icon:"â¬†ï¸",placement:"bottom"}},{id:"step3",target:'[data-tour-target="shortcut-cards"]',fallbackTitle:"Karty skrÃ³tÃ³w po prawej stronie",fallbackDescription:"PrzejdÅº stÄ…d do planera pakowania, listy zadaÅ„ i przewodnika po wynajmie auta â€“ wszystko w jednym miejscu.",arrow:{icon:"âž¡ï¸",placement:"left"}},{id:"step4",target:'[data-tour-target="tabs-navigation"]',fallbackTitle:"Nawigacja po zakÅ‚adkach i statystyki",fallbackDescription:"Tutaj zmienisz zakÅ‚adki przygody, pakowania, zadaÅ„ i VIP oraz sprawdzisz poziom, XP i zebrane odznaki.",arrow:{icon:"â¬†ï¸",placement:"bottom"}},{id:"step5",target:'[data-tour-target="help-button"]',fallbackTitle:"Potrzebujesz powtÃ³rki?",fallbackDescription:"Kliknij przycisk PokaÅ¼ instrukcjÄ™ w stopce, aby uruchomiÄ‡ samouczek ponownie w dowolnym momencie.",arrow:{icon:"â¬‡ï¸",placement:"top"}}],this.handleLanguageChange=this.handleLanguageChange.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.handleViewportChange=this.handleViewportChange.bind(this),this.handleBackdropClick=this.handleBackdropClick.bind(this)}init(){if(this.initialized)return void this.updateHelpButtonLabel();this.initialized=!0,this.createUi(),this.helpButton=document.getElementById("tutorialHelpButton"),this.helpButton&&this.helpButton.addEventListener("click",event=>{const trigger=event.currentTarget;trigger instanceof HTMLElement?this.start(trigger):this.start()}),document.addEventListener("wakacjecypr:languagechange",this.handleLanguageChange),this.translationsReady=areTranslationsReady(),this.updateUiText(),this.updateHelpButtonLabel();const languageSelector=window.languageSelector,selectorActive=languageSelector&&"function"==typeof languageSelector.shouldShow&&languageSelector.shouldShow();this.shouldAutoStart()&&this.translationsReady&&!selectorActive&&(this.start(),this.hasAutoStarted=!0)}shouldAutoStart(){return!this.hasSeenTutorial()&&this.isHomePage()}isHomePage(){return"home"===(document.body?.dataset?.seoPage||"")}hasSeenTutorial(){return"true"===safeLocalStorage("get","seenTutorial")}markAsSeen(){safeLocalStorage("set","seenTutorial","true"),this.hasAutoStarted=!0}createUi(){if(this.overlay)return;this.overlay=document.createElement("div"),this.overlay.className="tutorial-overlay",this.overlay.hidden=!0,this.overlay.setAttribute("aria-hidden","true"),this.backdrop=document.createElement("div"),this.backdrop.className="tutorial-backdrop",this.overlay.appendChild(this.backdrop),this.highlight=document.createElement("div"),this.highlight.className="tutorial-highlight",this.overlay.appendChild(this.highlight),this.arrowElement=document.createElement("div"),this.arrowElement.className="tutorial-arrow",this.arrowElement.setAttribute("aria-hidden","true"),this.overlay.appendChild(this.arrowElement),this.dialog=document.createElement("div"),this.dialog.className="tutorial-dialog",this.dialog.setAttribute("role","dialog"),this.dialog.setAttribute("aria-modal","true"),this.dialog.setAttribute("tabindex","-1"),this.dialog.setAttribute("aria-labelledby","tutorialDialogTitle"),this.dialog.setAttribute("aria-describedby","tutorialDialogDescription");const content=document.createElement("div");content.className="tutorial-content",content.setAttribute("aria-live","polite"),this.titleEl=document.createElement("h2"),this.titleEl.id="tutorialDialogTitle",content.appendChild(this.titleEl),this.descriptionEl=document.createElement("p"),this.descriptionEl.id="tutorialDialogDescription",content.appendChild(this.descriptionEl),this.dialog.appendChild(content);const controls=document.createElement("div");controls.className="tutorial-controls",this.prevButton=document.createElement("button"),this.prevButton.type="button",this.prevButton.className="tutorial-button-prev",this.prevButton.addEventListener("click",()=>{this.previousStep()}),this.skipButton=document.createElement("button"),this.skipButton.type="button",this.skipButton.className="tutorial-button-skip",this.skipButton.addEventListener("click",()=>{this.skipTutorial()}),this.nextButton=document.createElement("button"),this.nextButton.type="button",this.nextButton.className="tutorial-button-next",this.nextButton.addEventListener("click",()=>{this.nextStep()}),controls.append(this.prevButton,this.skipButton,this.nextButton),this.dialog.appendChild(controls),this.overlay.appendChild(this.dialog),document.body.appendChild(this.overlay),this.backdrop.addEventListener("click",this.handleBackdropClick)}waitForTranslations(callback){if(this.translationsReady)return void callback();const handler=()=>{this.translationsReady=areTranslationsReady(),this.translationsReady&&(document.removeEventListener("wakacjecypr:languagechange",handler),this.updateUiText(),callback())};document.addEventListener("wakacjecypr:languagechange",handler)}start(triggerElement){if(this.isOpen)return;const startTutorial=()=>{this.previouslyFocusedElement=document.activeElement instanceof HTMLElement?document.activeElement:null,this.launchSource=triggerElement instanceof HTMLElement?triggerElement:null,this.currentStepIndex=0,this.openOverlay(),this.renderCurrentStep({focusButton:!0})};this.translationsReady?startTutorial():this.waitForTranslations(()=>{startTutorial()})}openOverlay(){this.overlay&&(this.isOpen=!0,this.overlay.hidden=!1,this.overlay.setAttribute("aria-hidden","false"),this.overlay.classList.add("is-visible"),document.body.classList.add("tutorial-open"),document.addEventListener("keydown",this.handleKeydown,!0),window.addEventListener("resize",this.handleViewportChange,{passive:!0}),window.addEventListener("scroll",this.handleViewportChange,{passive:!0}),requestAnimationFrame(()=>{this.dialog&&this.dialog.focus({preventScroll:!0}),this.focusDefaultControl()}))}closeOverlay(){if(!this.isOpen||!this.overlay)return;this.isOpen=!1,this.overlay.classList.remove("is-visible"),this.overlay.setAttribute("aria-hidden","true"),this.overlay.hidden=!0,document.body.classList.remove("tutorial-open"),document.removeEventListener("keydown",this.handleKeydown,!0),window.removeEventListener("resize",this.handleViewportChange),window.removeEventListener("scroll",this.handleViewportChange),this.pendingFrame&&(cancelAnimationFrame(this.pendingFrame),this.pendingFrame=null),this.activeTarget&&(this.activeTarget.classList.remove("tutorial-target-active"),this.activeTarget=null),this.arrowElement&&this.arrowElement.classList.remove("is-visible"),this.highlight&&(this.highlight.style.width="0",this.highlight.style.height="0");const focusTarget=this.launchSource||this.previouslyFocusedElement;focusTarget instanceof HTMLElement&&focusTarget.focus({preventScroll:!0}),this.launchSource=null,this.previouslyFocusedElement=null}focusDefaultControl(){this.nextButton&&this.nextButton.focus({preventScroll:!0})}getFocusableElements(){return this.dialog?Array.from(this.dialog.querySelectorAll(FOCUSABLE_SELECTORS)).filter(element=>element instanceof HTMLElement&&null!==element.offsetParent):[]}handleKeydown(event){if(!this.isOpen)return;if("Escape"===event.key)return event.preventDefault(),void this.dismissTutorial();if("Tab"!==event.key)return;const focusable=this.getFocusableElements();if(0===focusable.length)return event.preventDefault(),void(this.dialog&&this.dialog.focus({preventScroll:!0}));const first=focusable[0],last=focusable[focusable.length-1],activeElement=document.activeElement instanceof HTMLElement?document.activeElement:null;event.shiftKey?activeElement!==first&&activeElement&&this.dialog?.contains(activeElement)||(event.preventDefault(),last.focus({preventScroll:!0})):activeElement===last&&(event.preventDefault(),first.focus({preventScroll:!0}))}handleBackdropClick(event){event.target===this.backdrop&&this.dismissTutorial()}handleViewportChange(){this.isOpen&&(this.pendingFrame&&cancelAnimationFrame(this.pendingFrame),this.pendingFrame=requestAnimationFrame(()=>{this.pendingFrame=null,this.updateHighlight(void 0,{ensureVisible:!1})}))}handleLanguageChange(){const readyBefore=this.translationsReady;this.translationsReady=areTranslationsReady(),this.updateUiText(),this.updateHelpButtonLabel(),!this.hasAutoStarted&&this.shouldAutoStart()&&this.translationsReady&&(this.start(),this.hasAutoStarted=!0),this.isOpen&&this.translationsReady?this.renderCurrentStep():!readyBefore&&this.translationsReady&&this.updateUiText()}updateUiText(){if(!this.prevButton||!this.nextButton||!this.skipButton)return;const prevLabel=getTranslation("tutorial.prev","Wstecz"),nextLabel=getTranslation("tutorial.next","Dalej"),skipLabel=getTranslation("tutorial.skip","PomiÅ„");this.prevButton.textContent=prevLabel,this.prevButton.setAttribute("aria-label",prevLabel),this.skipButton.textContent=skipLabel,this.skipButton.setAttribute("aria-label",skipLabel),this.nextButton.textContent=nextLabel,this.nextButton.setAttribute("aria-label",nextLabel)}updateHelpButtonLabel(){if(this.helpButton=this.helpButton||document.getElementById("tutorialHelpButton"),!this.helpButton)return;const label=getTranslation("tutorial.showAgain","ðŸ” PokaÅ¼ instrukcjÄ™");this.helpButton.textContent=label,this.helpButton.setAttribute("aria-label",label)}renderCurrentStep(options={}){const step=this.steps[this.currentStepIndex];if(!step)return;const title=getTranslation(`tutorial.${step.id}.title`,step.fallbackTitle),description=getTranslation(`tutorial.${step.id}.description`,step.fallbackDescription);this.titleEl&&(this.titleEl.textContent=title),this.descriptionEl&&(this.descriptionEl.textContent=description),this.updateHighlight(step,{ensureVisible:!0}),this.updateNavigationButtons(),options.focusButton&&this.focusDefaultControl()}updateHighlight(step,options={}){const activeStep=step||this.steps[this.currentStepIndex];if(!activeStep||!this.highlight||!this.arrowElement)return;const target=document.querySelector(activeStep.target);if(this.activeTarget&&this.activeTarget!==target&&this.activeTarget.classList.remove("tutorial-target-active"),target instanceof HTMLElement){this.activeTarget=target,target.classList.add("tutorial-target-active");const rect=target.getBoundingClientRect(),padding=14,top=Math.max(rect.top-padding,8),left=Math.max(rect.left-padding,8),width=rect.width+2*padding,height=rect.height+2*padding;this.highlight.style.top=`${top}px`,this.highlight.style.left=`${left}px`,this.highlight.style.width=`${Math.max(width,60)}px`,this.highlight.style.height=`${Math.max(height,60)}px`,options.ensureVisible&&"function"==typeof target.scrollIntoView&&target.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),this.positionArrow(rect,activeStep.arrow)}else this.activeTarget=null,this.highlight.style.width="0",this.highlight.style.height="0",this.arrowElement.classList.remove("is-visible")}positionArrow(rect,arrowConfig){if(!this.arrowElement||!arrowConfig)return;let top=rect.top-16,left=rect.left+rect.width/2,translateX="-50%",translateY="-100%";switch(arrowConfig.placement){case"bottom":top=rect.bottom+16,translateY="0";break;case"left":left=rect.left-16,translateX="-100%",translateY="-50%",top=rect.top+rect.height/2;break;case"right":left=rect.right+16,translateX="0",translateY="-50%",top=rect.top+rect.height/2;break;default:top=rect.top-16,translateY="-100%"}this.arrowElement.textContent=arrowConfig.icon||"â¬‡ï¸",this.arrowElement.style.top=`${top}px`,this.arrowElement.style.left=`${left}px`,this.arrowElement.style.transform=`translate(${translateX}, ${translateY})`,this.arrowElement.classList.add("is-visible")}updateNavigationButtons(){if(!this.prevButton||!this.nextButton||!this.skipButton)return;const isFirst=0===this.currentStepIndex,isLast=this.currentStepIndex===this.steps.length-1,prevLabel=getTranslation("tutorial.prev","Wstecz"),skipLabel=getTranslation("tutorial.skip","PomiÅ„"),nextLabel=isLast?getTranslation("tutorial.finish","ZakoÅ„cz"):getTranslation("tutorial.next","Dalej");this.prevButton.disabled=isFirst,this.prevButton.textContent=prevLabel,this.prevButton.setAttribute("aria-label",prevLabel),this.skipButton.textContent=skipLabel,this.skipButton.setAttribute("aria-label",skipLabel),this.nextButton.textContent=nextLabel,this.nextButton.setAttribute("aria-label",nextLabel)}nextStep(){this.currentStepIndex>=this.steps.length-1?this.finishTutorial():(this.currentStepIndex+=1,this.renderCurrentStep({focusButton:!0}))}previousStep(){0!==this.currentStepIndex&&(this.currentStepIndex-=1,this.renderCurrentStep({focusButton:!0}))}skipTutorial(){this.markAsSeen(),this.closeOverlay()}finishTutorial(){this.markAsSeen(),this.closeOverlay()}dismissTutorial(){this.markAsSeen(),this.closeOverlay()}};window.appTutorial=tutorialInstance}();