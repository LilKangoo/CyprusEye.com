!function(){let scrollPositionBeforeLock=0,bodyScrollLockCount=0,previousBodyOverflow="",previousBodyPosition="",previousBodyTop="",previousBodyWidth="",sosModal=null,sosDialog=null,sosClose=null,sosToggleButtons=null,sosPreviouslyFocusedElement=null;const focusableSelectors=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]'].join(", ");function getSosFocusableElements(){if(!sosModal)return[];const container=sosDialog??sosModal;return Array.from(container.querySelectorAll(focusableSelectors)).filter(element=>{if(!(element instanceof HTMLElement))return!1;if(element.hasAttribute("disabled")||"true"===element.getAttribute("aria-hidden"))return!1;const style=window.getComputedStyle(element);return"hidden"!==style.visibility&&"none"!==style.display&&(null!==element.offsetParent||"fixed"===style.position)})}function handleSosKeydown(event){if(!sosModal||sosModal.hidden||!sosModal.classList.contains("visible"))return;if("PageDown"===event.key||"PageUp"===event.key){if(!(sosDialog instanceof HTMLElement))return;if(sosDialog.scrollHeight<=sosDialog.clientHeight)return;event.preventDefault();const direction="PageDown"===event.key?1:-1;return void sosDialog.scrollBy({top:direction*sosDialog.clientHeight,behavior:"auto"})}if("Tab"!==event.key)return;const focusableElements=getSosFocusableElements();if(0===focusableElements.length)return event.preventDefault(),void(sosDialog instanceof HTMLElement&&sosDialog.focus({preventScroll:!0}));const firstElement=focusableElements[0],lastElement=focusableElements[focusableElements.length-1],activeElement=document.activeElement instanceof HTMLElement?document.activeElement:null;event.shiftKey?activeElement!==firstElement&&activeElement&&sosModal.contains(activeElement)||(event.preventDefault(),lastElement.focus({preventScroll:!0})):activeElement===lastElement&&(event.preventDefault(),firstElement.focus({preventScroll:!0}))}function finalizeSosClose(){sosModal&&(sosModal.hidden=!0,0!==bodyScrollLockCount&&(bodyScrollLockCount-=1,bodyScrollLockCount>0||(document.body.style.overflow=previousBodyOverflow,document.body.style.position=previousBodyPosition,document.body.style.top=previousBodyTop,document.body.style.width=previousBodyWidth,scrollPositionBeforeLock>0&&window.scrollTo(0,scrollPositionBeforeLock),scrollPositionBeforeLock=0)),sosPreviouslyFocusedElement instanceof HTMLElement&&sosPreviouslyFocusedElement.focus({preventScroll:!0}),sosPreviouslyFocusedElement=null)}function openSosModal(triggerElement){sosModal?!sosModal.hidden&&sosModal.classList.contains("visible")||(sosPreviouslyFocusedElement=triggerElement instanceof HTMLElement?triggerElement:document.activeElement instanceof HTMLElement?document.activeElement:null,0===bodyScrollLockCount&&(scrollPositionBeforeLock=window.scrollY||window.pageYOffset||0,previousBodyOverflow=document.body.style.overflow,previousBodyPosition=document.body.style.position,previousBodyTop=document.body.style.top,previousBodyWidth=document.body.style.width,document.body.style.overflow="hidden",document.body.style.position="fixed",document.body.style.top=`-${scrollPositionBeforeLock}px`,document.body.style.width="100%"),bodyScrollLockCount+=1,sosModal.hidden=!1,requestAnimationFrame(()=>{sosModal.classList.add("visible"),function(){if(!sosModal)return;const focusableElements=getSosFocusableElements();focusableElements.length>0?focusableElements[0].focus({preventScroll:!0}):sosDialog instanceof HTMLElement&&sosDialog.focus({preventScroll:!0})}()})):console.error("❌ SOS Modal not found!")}function closeSosModal(){if(!sosModal)return;const wasVisible=sosModal.classList.contains("visible");if(sosModal.classList.remove("visible"),!wasVisible)return void finalizeSosClose();const handleTransitionEnd=event=>{event.target===sosModal&&(sosModal.removeEventListener("transitionend",handleTransitionEnd),finalizeSosClose())};sosModal.addEventListener("transitionend",handleTransitionEnd),setTimeout(()=>{sosModal&&!sosModal.classList.contains("visible")&&(sosModal.removeEventListener("transitionend",handleTransitionEnd),finalizeSosClose())},320)}function initSosModal(){sosModal=document.getElementById("sosModal"),sosDialog=sosModal?.querySelector(".sos-dialog"),sosClose=document.getElementById("sosClose"),sosToggleButtons=document.querySelectorAll('[aria-controls="sosModal"]'),sosModal?(sosToggleButtons.length,sosToggleButtons.forEach((button,index)=>{button.addEventListener("click",event=>{event.preventDefault(),event.stopPropagation();const trigger=event.currentTarget;trigger instanceof HTMLElement?openSosModal(trigger):openSosModal()})}),sosClose?.addEventListener("click",()=>{closeSosModal()}),sosModal.addEventListener("click",event=>{event.target===sosModal&&closeSosModal()}),sosModal.addEventListener("keydown",handleSosKeydown),document.addEventListener("keydown",event=>{"Escape"===event.key&&sosModal&&!sosModal.hidden&&closeSosModal()})):console.error("❌ SOS Modal element (#sosModal) not found in DOM")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initSosModal):initSosModal()}();