<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FCSE0876CR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FCSE0876CR');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://esm.sh https://unpkg.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://daoohnbnnowmmcizgvrq.supabase.co https://www.google-analytics.com https://region1.google-analytics.com https://*.tile.openstreetmap.org https://unpkg.com https://esm.sh; frame-src 'self' https://docs.google.com; object-src 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;">
  
  <meta name="theme-color" content="#2563eb" />
  <meta name="robots" content="noindex,nofollow" />
  <title data-i18n="dashboard.meta.title">User Dashboard ‚Äì CyprusEye Quest</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="assets/css/tokens.css" />
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/components.css" />
  <link rel="stylesheet" href="assets/css/header-metrics.css" />
  <link rel="stylesheet" href="assets/css/mobile.css" />
  <link rel="stylesheet" href="assets/css/mobile-nav.css" />
  <link rel="stylesheet" href="css/toast.css" />
  <!-- New Dashboard Styles -->
  <link rel="stylesheet" href="assets/css/dashboard.css" />

  <meta name="ce-auth" content="on" />
  <script type="module" src="js/supabaseClient.js"></script>
  <script type="module" src="js/toast.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/authUi.js"></script>
</head>
<body data-navigation="dashboard" class="dashboard-body">
  
  <div id="authMessage" class="auth-message" role="status" aria-live="polite"></div>

  <!-- Dashboard Layout -->
  <div class="dashboard-container">
    
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-brand">
          <img src="assets/cyprus_logo-1000x1054.png" alt="Logo" width="32" height="32">
          <span>CyprusEye</span>
        </a>
      </div>

      <div class="user-brief">
        <div class="user-brief-avatar">
          <img id="sidebarAvatar" src="assets/cyprus_logo-1000x1054.png" alt="Avatar">
        </div>
        <div class="user-brief-info">
          <p id="sidebarUsername" class="user-brief-name">Loading...</p>
          <p id="sidebarLevel" class="user-brief-level">Level 1</p>
        </div>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-section="overview">
          <span class="icon">üìä</span>
          <span data-i18n="dashboard.nav.overview">Overview</span>
        </button>
        <button class="nav-item" data-section="reservations">
          <span class="icon">üìÖ</span>
          <span data-i18n="dashboard.nav.reservations">Orders & Bookings</span>
          <span class="badge-count" id="reservationsCount" hidden>0</span>
        </button>
        <button class="nav-item" data-section="achievements">
          <span class="icon">üèÜ</span>
          <span data-i18n="dashboard.nav.achievements">Achievements</span>
        </button>
        <button class="nav-item" data-section="settings">
          <span class="icon">‚öôÔ∏è</span>
          <span data-i18n="dashboard.nav.settings">Settings</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <button class="nav-item logout-btn" data-auth="logout">
          <span class="icon">üö™</span>
          <span data-i18n="auth.logout">Log out</span>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
      
      <!-- Mobile Header -->
      <header class="dashboard-mobile-header">
        <a href="index.html" class="mobile-logo">
          <img src="assets/cyprus_logo-1000x1054.png" alt="Logo" width="32">
        </a>
        <button id="mobileMenuToggle" class="mobile-menu-toggle">‚ò∞</button>
      </header>

      <!-- SECTION: OVERVIEW -->
      <section id="section-overview" class="dashboard-section active">
        <div class="section-header">
          <h1 data-i18n="dashboard.overview.title">Welcome back!</h1>
          <p data-i18n="dashboard.overview.subtitle">Here is what's happening with your adventure.</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon xp">‚ú®</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.xp">Experience</h3>
              <p class="stat-number" id="overviewXP">0 XP</p>
              <div class="progress-bar-sm">
                <div class="progress-fill" id="overviewXPBar" style="width: 0%"></div>
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon level">üÜô</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.level">Level</h3>
              <p class="stat-number" id="overviewLevel">1</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon places">üìç</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.visited">Visited</h3>
              <p class="stat-number" id="overviewVisited">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon bookings">üìÖ</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.activeBookings">Active Bookings</h3>
              <p class="stat-number" id="overviewActiveBookings">0</p>
            </div>
          </div>
        </div>

        <div class="content-grid">
          <!-- Recent Activity -->
          <div class="card dashboard-card wide">
            <div class="card-header">
              <h2 data-i18n="dashboard.activity.title">Recent Activity</h2>
            </div>
            <div class="card-body" id="recentActivityList">
              <p class="empty-state" data-i18n="dashboard.activity.empty">No recent activity.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: RESERVATIONS -->
      <section id="section-reservations" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.reservations.title">My Orders & Bookings</h1>
          <p data-i18n="dashboard.reservations.subtitle">Track current status of your trips, hotels and rentals.</p>
        </div>

        <div class="reservations-container">
          <!-- Tabs -->
          <div class="tabs-line">
            <button class="tab-btn active" data-filter="all" data-i18n="dashboard.reservations.all">All</button>
            <button class="tab-btn" data-filter="pending" data-i18n="dashboard.reservations.pending">Pending</button>
            <button class="tab-btn" data-filter="confirmed" data-i18n="dashboard.reservations.confirmed">Confirmed</button>
            <button class="tab-btn" data-filter="completed" data-i18n="dashboard.reservations.completed">History</button>
          </div>

          <div class="reservations-list" id="reservationsList">
            <!-- Loading State -->
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Loading orders...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: ACHIEVEMENTS -->
      <section id="section-achievements" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.achievements.title">Badges & Rewards</h1>
        </div>
        <div class="badges-grid" id="badgesGrid">
          <!-- Filled by JS -->
          <p>Loading badges...</p>
        </div>
      </section>

      <!-- SECTION: SETTINGS -->
      <section id="section-settings" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.settings.title">Account Settings</h1>
        </div>
        <div class="settings-grid">
          <div class="card dashboard-card">
            <div class="card-header">
              <h2 data-i18n="profile.profile">Profile</h2>
            </div>
            <div class="card-body settings-form">
              <div class="form-group">
                <label data-i18n="profile.avatar.change">Avatar</label>
                <div class="avatar-upload-row">
                  <img id="settingsAvatarPreview" src="assets/cyprus_logo-1000x1054.png" width="64" height="64">
                  <button class="btn btn-secondary btn-sm" id="uploadAvatarBtn" data-i18n="profile.avatar.change">Change</button>
                  <input type="file" id="avatarInput" hidden accept="image/*">
                </div>
              </div>
              <div class="form-group">
                <label data-i18n="profile.username.label">Username</label>
                <div class="input-group">
                  <input type="text" id="settingsUsername" disabled>
                  <button class="btn btn-ghost btn-sm" id="editUsernameBtn">Edit</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card dashboard-card">
            <div class="card-header">
              <h2 data-i18n="profile.security">Security</h2>
            </div>
            <div class="card-body">
              <button class="btn btn-outline" id="changePasswordBtn" data-i18n="profile.security.password.change">Change Password</button>
              <div class="danger-zone">
                <p class="text-danger" data-i18n="profile.security.delete.warning">Deleting your account is irreversible.</p>
                <button class="btn btn-danger btn-sm" id="deleteAccountBtn" data-i18n="profile.security.delete">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Scripts -->
  <script src="js/languageSelector.js" defer></script>
  <script src="js/i18n.js" defer></script>
  
  <!-- Load core logic -->
  <script type="module" src="js/dashboard.js"></script>

</body>
</html>
