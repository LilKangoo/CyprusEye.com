<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-FCSE0876CR"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-FCSE0876CR');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Security: Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://www.googletagmanager.com https://esm.sh https://unpkg.com https://static.cloudflareinsights.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://unpkg.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://daoohnbnnowmmcizgvrq.supabase.co https://www.google-analytics.com https://region1.google-analytics.com https://*.tile.openstreetmap.org https://unpkg.com https://esm.sh; frame-src 'self' https://docs.google.com; object-src 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;">
  
  <meta name="theme-color" content="#2563eb" />
  <meta name="robots" content="noindex,nofollow" />
  <title data-i18n="dashboard.meta.title">User Dashboard â€“ CyprusEye Quest</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <link rel="stylesheet" href="assets/css/tokens.css" />
  <link rel="stylesheet" href="assets/css/base.css" />
  <link rel="stylesheet" href="assets/css/components.css" />
  <link rel="stylesheet" href="assets/css/header-metrics.css" />
  <link rel="stylesheet" href="assets/css/mobile.css" />
  <link rel="stylesheet" href="assets/css/mobile-nav.css" />
  <link rel="stylesheet" href="css/toast.css" />
  <!-- New Dashboard Styles -->
  <link rel="stylesheet" href="assets/css/dashboard.css" />

  <meta name="ce-auth" content="on" />
  <script type="module" src="js/supabaseClient.js"></script>
  <script type="module" src="js/toast.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/authUi.js"></script>
</head>
<body data-navigation="dashboard" class="dashboard-body">
  
  <div id="authMessage" class="auth-message" role="status" aria-live="polite"></div>

  <!-- Global Header -->
  <header class="app-header nav-modern">
      <div class="nav-modern__top" aria-label="Global header">
        <div class="brand nav-modern__brand-block">
          <a href="index.html" class="nav-modern__brand-link" aria-label="CyprusEye Quest home">
            <img
              src="assets/cyprus_logo-1000x1054.png"
              alt="WakacjeCypr.com â€“ logo Å¼Ã³Å‚wia z flagÄ… Polski"
              data-i18n-attrs="alt:header.logoAlt"
              width="1000"
              height="1054"
              loading="eager"
              fetchpriority="high"
            />
            <div class="brand-title" data-i18n="header.brand">
              <p class="brand-name">CyprusEye Quest &amp; Travel</p>
            </div>
          </a>
        </div>

        <div class="nav-modern__top-actions">
          <button
            id="sosToggle"
            class="nav-modern__sos"
            type="button"
            aria-haspopup="dialog"
            aria-controls="sosModal"
            data-i18n="header.sosToggle"
          >
            âš ï¸ SOS
          </button>

          <div class="language-pill-group" data-language-toggle aria-label="Language selector" data-i18n-attrs="aria-label:language.switcher.label">
            <button type="button" class="language-pill" data-language-pill="pl" aria-pressed="false">PL</button>
            <button type="button" class="language-pill" data-language-pill="en" aria-pressed="false">EN</button>
            <!-- <button type="button" class="language-pill" data-language-pill="el" aria-pressed="false">EL</button> -->
            <!-- <button type="button" class="language-pill" data-language-pill="he" aria-pressed="false">HE</button> -->
          </div>
        </div>
      </div>
    <div class="nav-modern__shell">

      <div class="nav-modern__bars" data-tour-target="tabs-navigation">
        <button class="nav-modern__toggle-btn" id="navToggleBtn" aria-expanded="false" aria-controls="navLinksRow" data-i18n="nav.toggle">
          â˜° Nawigacja
        </button>
        <div class="nav-modern__links-row" id="navLinksRow" aria-label="GÅ‚Ã³wna nawigacja i skrÃ³ty" data-i18n-attrs="aria-label:header.quickActions.aria">
          <nav class="nav-modern__tabs" role="tablist" data-i18n-attrs="aria-label:header.tabs.aria" aria-label="Nawigacja gÅ‚Ã³wna">
            <a href="index.html" class="nav-modern__tab" id="headerAdventureTab" data-i18n="nav.adventure">
              ğŸ¯ Przygoda
            </a>
            <a href="community.html" class="nav-modern__tab" id="headerPackingTab" data-i18n="nav.community">
              ğŸ’¬ SpoÅ‚ecznoÅ›Ä‡
            </a>
            <a href="recommendations.html" class="nav-modern__tab" id="headerRecommendationsTab" data-i18n="nav.recommendations">
              âœ¨ Polecane
            </a>
            <a href="tasks.html" class="nav-modern__tab" id="headerTasksTab" data-i18n="nav.tasks">
              â˜‘ï¸ Zadania
            </a>
          </nav>

          <div class="nav-modern__chips">
            <a class="nav-chip" href="packing.html" data-i18n="nav.packing">ğŸ’ Pakowanie</a>
            <a class="nav-chip" href="kupon.html" data-i18n="header.coupon">ğŸŸï¸ Kupon</a>
            <a class="nav-chip" href="car-rental-landing.html" data-i18n="header.carRentalLink">ğŸš— Wynajem auta</a>
            <a class="nav-chip" href="trips.html" data-i18n="nav.trips">ğŸ§­ Wycieczki</a>
            <a class="nav-chip" href="hotels.html" data-i18n="nav.hotels">ğŸ¨ Hotele</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Dashboard Layout -->
  <div class="dashboard-container">
    
    <!-- Sidebar -->
    <aside class="dashboard-sidebar">
      <div class="user-brief">
        <div class="user-brief-avatar">
          <img id="sidebarAvatar" src="assets/cyprus_logo-1000x1054.png" alt="Avatar">
        </div>
        <div class="user-brief-info">
          <p id="sidebarUsername" class="user-brief-name">Loading...</p>
          <p id="sidebarLevel" class="user-brief-level">Level 1</p>
        </div>
      </div>

      <nav class="sidebar-nav">
        <button class="nav-item active" data-section="overview">
          <span class="icon">ğŸ“Š</span>
          <span data-i18n="dashboard.nav.overview">Overview</span>
        </button>
        <button class="nav-item" data-section="reservations">
          <span class="icon">ğŸ“…</span>
          <span data-i18n="dashboard.nav.reservations">Orders & Bookings</span>
          <span class="badge-count" id="reservationsCount" hidden>0</span>
        </button>
        <button class="nav-item" data-section="content">
          <span class="icon">ğŸ“</span>
          <span data-i18n="dashboard.nav.content">My Content</span>
        </button>
        <button class="nav-item" data-section="achievements">
          <span class="icon">ğŸ†</span>
          <span data-i18n="dashboard.nav.achievements">Achievements</span>
        </button>
        <button class="nav-item" data-section="settings">
          <span class="icon">âš™ï¸</span>
          <span data-i18n="dashboard.nav.settings">Settings</span>
        </button>
      </nav>

      <div class="sidebar-footer">
        <button class="nav-item logout-btn" data-auth="logout">
          <span class="icon">ğŸšª</span>
          <span data-i18n="auth.logout">Log out</span>
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="dashboard-main">
      
      <!-- Mobile Sidebar Toggle (Visible only on mobile) -->
      <div class="dashboard-mobile-toggle-bar">
        <button class="mobile-sidebar-toggle" id="dashboardSidebarToggle">
          â˜° <span class="mobile-page-title" data-i18n="dashboard.nav.overview">Menu</span>
        </button>
      </div>

      <!-- SECTION: OVERVIEW -->
      <section id="section-overview" class="dashboard-section active">
        <div class="section-header">
          <h1 data-i18n="dashboard.overview.title">Welcome back!</h1>
          <p data-i18n="dashboard.overview.subtitle">Here is what's happening with your adventure.</p>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon xp">âœ¨</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.xp">Experience</h3>
              <p class="stat-number" id="overviewXP">0 XP</p>
              <div class="progress-bar-sm">
                <div class="progress-fill" id="overviewXPBar" style="width: 0%"></div>
              </div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon level">ğŸ†™</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.level">Level</h3>
              <p class="stat-number" id="overviewLevel">1</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon places">ğŸ“</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.visited">Visited</h3>
              <p class="stat-number" id="overviewVisited">0</p>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon bookings">ğŸ“…</div>
            <div class="stat-details">
              <h3 data-i18n="metrics.activeBookings">Active Bookings</h3>
              <p class="stat-number" id="overviewActiveBookings">0</p>
            </div>
          </div>
        </div>

        <div class="content-grid">
          <!-- Recent Activity -->
          <div class="card dashboard-card wide">
            <div class="card-header">
              <h2 data-i18n="dashboard.activity.title">Recent Activity</h2>
            </div>
            <div class="card-body" id="recentActivityList">
              <p class="empty-state" data-i18n="dashboard.activity.empty">No recent activity.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: RESERVATIONS -->
      <section id="section-reservations" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.reservations.title">My Orders & Bookings</h1>
          <p data-i18n="dashboard.reservations.subtitle">Track current status of your trips, hotels and rentals.</p>
        </div>

        <div class="reservations-container">
          <!-- Tabs -->
          <div class="tabs-line">
            <button class="tab-btn active" data-filter="all" data-i18n="dashboard.reservations.all">All</button>
            <button class="tab-btn" data-filter="pending" data-i18n="dashboard.reservations.pending">Pending</button>
            <button class="tab-btn" data-filter="confirmed" data-i18n="dashboard.reservations.confirmed">Confirmed</button>
            <button class="tab-btn" data-filter="completed" data-i18n="dashboard.reservations.completed">History</button>
          </div>

          <div class="reservations-list" id="reservationsList">
            <!-- Loading State -->
            <div class="loading-state">
              <div class="spinner"></div>
              <p>Loading orders...</p>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: CONTENT (New) -->
      <section id="section-content" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.content.title">My Content</h1>
          <p data-i18n="dashboard.content.subtitle">Manage your photos and comments.</p>
        </div>

        <div class="content-container">
          <div class="tabs-line">
            <button class="tab-btn active" data-content-tab="photos" data-i18n="dashboard.content.photos">Photos</button>
            <button class="tab-btn" data-content-tab="comments" data-i18n="dashboard.content.comments">Comments</button>
          </div>

          <div id="content-photos" class="content-tab-pane active">
            <div class="photos-grid" id="userPhotosList">
              <div class="loading-state"><div class="spinner"></div><p>Loading photos...</p></div>
            </div>
          </div>

          <div id="content-comments" class="content-tab-pane" style="display:none">
            <div class="comments-list" id="userCommentsList">
              <div class="loading-state"><div class="spinner"></div><p>Loading comments...</p></div>
            </div>
          </div>
        </div>
      </section>

      <!-- SECTION: ACHIEVEMENTS -->
      <section id="section-achievements" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.achievements.title">Badges & Rewards</h1>
        </div>
        <div class="badges-grid" id="badgesGrid">
          <!-- Filled by JS -->
          <p>Loading badges...</p>
        </div>
      </section>

      <!-- SECTION: SETTINGS -->
      <section id="section-settings" class="dashboard-section">
        <div class="section-header">
          <h1 data-i18n="dashboard.settings.title">Account Settings</h1>
        </div>
        <div class="settings-grid">
          <div class="card dashboard-card">
            <div class="card-header">
              <h2 data-i18n="profile.profile">Profile</h2>
            </div>
            <div class="card-body settings-form">
              <div class="form-group">
                <label data-i18n="profile.avatar.change">Avatar</label>
                <div class="avatar-upload-row">
                  <img id="settingsAvatarPreview" src="assets/cyprus_logo-1000x1054.png" width="64" height="64">
                  <button class="btn btn-secondary btn-sm" id="uploadAvatarBtn" data-i18n="profile.avatar.change">Change</button>
                  <input type="file" id="avatarInput" hidden accept="image/*">
                </div>
              </div>
              <div class="form-group">
                <label data-i18n="profile.username.label">Username</label>
                <div class="input-group">
                  <input type="text" id="settingsUsername" disabled>
                  <button class="btn btn-ghost btn-sm" id="editUsernameBtn">Edit</button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card dashboard-card">
            <div class="card-header">
              <h2 data-i18n="profile.security">Security</h2>
            </div>
            <div class="card-body">
              <button class="btn btn-outline" id="changePasswordBtn" data-i18n="profile.security.password.change">Change Password</button>
              <div class="danger-zone">
                <p class="text-danger" data-i18n="profile.security.delete.warning">Deleting your account is irreversible.</p>
                <button class="btn btn-danger btn-sm" id="deleteAccountBtn" data-i18n="profile.security.delete">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Booking Details Modal -->
  <div id="bookingDetailsModal" class="modal-overlay" hidden>
    <div class="modal-content dashboard-modal">
      <div class="modal-header">
        <h2 id="bookingDetailTitle">Booking Details</h2>
        <button class="close-modal-btn" id="btnCloseModalX">&times;</button>
      </div>
      <div class="modal-body" id="bookingDetailBody">
        <!-- Details injected by JS -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" id="btnCloseModalBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="js/languageSwitcher.js"></script>
  <script src="js/languageSelector.js" defer></script>
  <script src="js/i18n.js" defer></script>
  <script src="js/mobile-nav.js" defer></script>
  <script src="js/header-dropdown.js" defer></script>
  
  <!-- Load core logic -->
  <script type="module" src="js/dashboard.js"></script>

</body>
</html>
