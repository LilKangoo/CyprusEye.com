<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://esm.sh https://*.esm.sh; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://daoohnbnnowmmcizgvrq.supabase.co https://*.supabase.co https://esm.sh; object-src 'none'; base-uri 'self'; form-action 'self';">
  <meta name="robots" content="noindex,nofollow" />
  <title>Admin · Trips</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/assets/css/tokens.css" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/admin/admin.css" />
  <script type="module" src="/js/supabaseClient.js"></script>
  <script type="module" src="/public/admin/trips.js"></script>
</head>
<body>
  <header class="admin-header">
    <div class="admin-header-content">
      <div class="admin-header-left">
        <a href="/admin/dashboard.html" class="btn-secondary" style="margin-right:12px;display:inline-flex;align-items:center;gap:8px;">
          ← Back
        </a>
        <h1 class="admin-title">Trips</h1>
      </div>
      <div class="admin-header-right">
        <button class="btn-admin-logout" id="btnTripsLogout">Logout</button>
      </div>
    </div>
  </header>

  <main class="admin-main">
    <section class="admin-view" style="display:block;">
      <div class="admin-view-header">
        <div>
          <h2>Manage Trips</h2>
          <p class="admin-view-subtitle">Create and edit trips. Images writable only by admin.</p>
        </div>
        <div class="admin-view-actions">
          <button class="btn-primary" id="btnNewTrip">New Trip</button>
          <button class="btn-secondary" id="btnRefreshTrips">Refresh</button>
        </div>
      </div>

      <div class="admin-section" style="margin-bottom:24px;">
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="tripSearch" placeholder="Search by slug or city" style="flex:1;" />
          <select id="tripStatusFilter">
            <option value="">All statuses</option>
            <option value="draft">Draft</option>
            <option value="review">Review</option>
            <option value="published">Published</option>
            <option value="archived">Archived</option>
          </select>
          <button class="btn-secondary" id="btnSearchTrips">Search</button>
        </div>
      </div>

      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Slug</th>
              <th>Start City</th>
              <th>Model</th>
              <th>Status</th>
              <th>Updated</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="tripsTable">
            <tr><td colspan="6" class="table-loading">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="admin-section" style="margin-top:24px;">
        <h3 id="tripFormTitle">New Trip</h3>
        <form id="tripForm" class="admin-form" style="display:grid;grid-template-columns:repeat(2,1fr);gap:16px;">
          <input type="hidden" name="id" />
          <label>Slug<input name="slug" required /></label>
          <label>Start City<input name="start_city" required /></label>
          <label>Categories (comma separated)<input name="categories" /></label>
          <label>Display Mode
            <select name="display_mode">
              <option value="auto">auto</option>
              <option value="from_price">from_price</option>
              <option value="per_person">per_person</option>
              <option value="per_hour">per_hour</option>
              <option value="custom_label">custom_label</option>
            </select>
          </label>
          <label>Display Label<input name="display_label" /></label>
          <label>Cover Image URL<input name="cover_image_url" /></label>

          <label style="grid-column:1/-1;">Tytuł (PL)
            <input name="title_pl" required />
          </label>
          <label style="grid-column:1/-1;">Opis (PL)
            <textarea name="description_pl" rows="4"></textarea>
          </label>

          <label>Pricing Model
            <select name="pricing_model" id="pricingModel">
              <option value="per_person">per_person</option>
              <option value="base_plus_extra">base_plus_extra</option>
              <option value="per_hour">per_hour</option>
              <option value="per_day">per_day</option>
            </select>
          </label>
          <div id="priceFields"></div>

          <div style="grid-column:1/-1;display:flex;gap:8px;">
            <button class="btn-primary" type="submit" id="btnSaveTrip">Save</button>
            <button class="btn-secondary" type="button" id="btnPublishTrip">Publish</button>
            <button class="btn-secondary" type="button" id="btnResetForm">Reset</button>
          </div>
        </form>
      </div>

      <div class="admin-section" style="margin-top:24px;">
        <h3>Bookings</h3>
        <div class="admin-table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Total</th>
                <th>Status</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody id="bookingsTable">
              <tr><td colspan="5" class="table-loading">Select a trip to load bookings</td></tr>
            </tbody>
          </table>
        </div>
      </div>

    </section>
  </main>
</body>
</html>
