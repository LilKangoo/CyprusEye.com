<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Security: Content Security Policy - Admin Panel -->
  <!-- Note: Relaxed CSP for admin panel - protected by authentication -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://esm.sh https://*.esm.sh; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https: blob:; connect-src 'self' https://daoohnbnnowmmcizgvrq.supabase.co https://*.supabase.co https://esm.sh; object-src 'none'; base-uri 'self'; form-action 'self';">
  <!-- Admin panel is already protected by multi-layer authentication -->
  
  <meta name="theme-color" content="#dc2626" />
  <meta name="robots" content="noindex,nofollow" />
  <title>CyprusEye Admin Panel</title>
  <meta name="description" content="Admin panel for CyprusEye Quest management" />
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <!-- Styles -->
  <link rel="stylesheet" href="/assets/css/tokens.css" />
  <link rel="stylesheet" href="/assets/css/base.css" />
  <link rel="stylesheet" href="/admin/admin.css" />
  
  <!-- Auth meta -->
  <meta name="ce-auth" content="required" />
  <meta name="ce-admin" content="required" />
  
  <!-- Scripts -->
  <script type="module" src="/js/supabaseClient.js"></script>
  <script type="module" src="/js/toast.js"></script>
  <!-- POI Loader for refresh functionality -->
  <script src="/js/poi-loader.js"></script>
  <script src="/js/data-places.js"></script>
  <script type="module" src="/admin/admin.js"></script>
</head>
<body data-admin-panel="true">
  
  <!-- Admin Header -->
  <header class="admin-header">
    <div class="admin-header-content">
      <div class="admin-header-left">
        <button
          type="button"
          class="admin-menu-toggle"
          id="adminMenuToggle"
          aria-label="Toggle navigation menu"
          aria-controls="adminSidebar"
          aria-expanded="false"
        >
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6" />
            <line x1="3" y1="12" x2="21" y2="12" />
            <line x1="3" y1="18" x2="21" y2="18" />
          </svg>
        </button>
        
        <h1 class="admin-title">
          <svg class="admin-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
          CyprusEye Admin
        </h1>
        <div class="admin-breadcrumb" id="breadcrumb">
          <span>Dashboard</span>
        </div>

  <!-- Diagnostics Auto-Fix Modal -->
  <div class="admin-modal" id="diagnosticFixModal" hidden>
    <div class="admin-modal-overlay" id="diagnosticFixModalOverlay"></div>
    <div class="admin-modal-content admin-modal-content-large">
      <header class="admin-modal-header">
        <h3 id="diagnosticFixTitle">Auto-Fix</h3>
        <button class="btn-modal-close" id="btnCloseDiagnosticFix">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body" id="diagnosticFixContent">
        <div class="admin-card">
          <div class="admin-card-body">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px;">
              <div>
                <p class="admin-view-subtitle" id="diagnosticFixDescription">Copy the SQL below and run it in Supabase SQL Editor.</p>
              </div>
              <div>
                <button class="btn-secondary" id="btnCopyDiagnosticSql">Copy SQL</button>
              </div>
            </div>
            <textarea id="diagnosticFixSql" readonly style="width:100%; min-height:260px; background:var(--admin-bg); color:var(--admin-text); border:1px solid var(--admin-border); border-radius:8px; padding:12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size:13px;"></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>
      </div>
      <div class="admin-header-right">
        <div class="admin-user-info" id="adminUserInfo">
          <span class="admin-user-name" id="adminUserName">Loading...</span>
          <span class="admin-user-role">Super Admin</span>
        </div>
        <button class="btn-admin-logout" id="btnAdminLogout" title="Logout">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <div class="admin-sidebar-overlay" id="adminSidebarOverlay" hidden></div>

  <!-- Loading Screen -->
  <div class="admin-loading" id="adminLoading">
    <div class="admin-loading-spinner"></div>
    <p>Verifying admin access...</p>
  </div>

  <!-- Login Screen -->
  <div class="admin-login-screen" id="adminLoginScreen" hidden>
    <div class="admin-login-container">
      <div class="admin-login-header">
        <svg class="admin-login-logo" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
        </svg>
        <h1>CyprusEye Admin</h1>
        <p>Sign in to access the admin panel</p>
      </div>

      <form id="adminLoginForm" class="admin-login-form">
        <div class="admin-form-group">
          <label for="adminLoginEmail">Email</label>
          <input 
            type="email" 
            id="adminLoginEmail" 
            name="email" 
            placeholder="admin@cypruseye.com"
            required
            autocomplete="email"
          />
        </div>

        <div class="admin-form-group">
          <label for="adminLoginPassword">Password</label>
          <input 
            type="password" 
            id="adminLoginPassword" 
            name="password" 
            placeholder="••••••••"
            required
            autocomplete="current-password"
          />
        </div>

        <div id="adminLoginError" class="admin-login-error" hidden></div>

        <button type="submit" class="btn-admin-login" id="btnAdminLogin">
          <span class="btn-text">Sign In</span>
          <span class="btn-spinner" hidden>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83"/>
            </svg>
          </span>
        </button>
      </form>

      <div class="admin-login-footer">
        <a href="/" class="admin-login-link">← Back to Home</a>
      </div>
    </div>
  </div>

  <!-- Access Denied Screen -->
  <div class="admin-access-denied" id="adminAccessDenied" hidden>
    <div class="access-denied-content">
      <svg class="access-denied-icon" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <line x1="15" y1="9" x2="9" y2="15"/>
        <line x1="9" y1="9" x2="15" y2="15"/>
      </svg>
      <h2>Access Denied</h2>
      <p>You don't have permission to access this panel.</p>
      <p style="margin-top: 16px; color: var(--admin-text-muted); font-size: 14px;">
        Only <strong>lilkangoomedia@gmail.com</strong> has admin access.
      </p>
      <div style="display: flex; gap: 12px; margin-top: 24px; justify-content: center;">
        <button class="btn-secondary" onclick="window.location.reload()">Try Again</button>
        <a href="/" class="btn-primary">Go to Home</a>
      </div>
    </div>
  </div>

  <!-- Main Admin Panel -->
  <div class="admin-container" id="adminContainer" hidden>
    
    <!-- Sidebar Navigation -->
    <aside class="admin-sidebar" id="adminSidebar">
      <nav class="admin-nav">
        <button class="admin-nav-item active" data-view="dashboard">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/>
            <rect x="14" y="3" width="7" height="7"/>
            <rect x="14" y="14" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
          </svg>
          <span>Dashboard</span>
        </button>
        
        <button class="admin-nav-item" data-view="users">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
          <span>Users</span>
        </button>
        
        <button class="admin-nav-item" data-view="pois">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
            <circle cx="12" cy="10" r="3"/>
          </svg>
          <span>POIs</span>
        </button>
        
        <button class="admin-nav-item" data-view="quests">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19l-3.5 2 1-4-3-3 4-.5L12 9l1.5 4.5 4 .5-3 3 1 4z"/>
          </svg>
          <span>Quests</span>
        </button>
        
        <button class="admin-nav-item" data-view="content">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
          <span>Content</span>
        </button>
        
        <button class="admin-nav-item" data-view="diagnostics">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
          </svg>
          <span>Diagnostics</span>
        </button>
        
        <button class="admin-nav-item" data-view="settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6m0-18a11 11 0 0 1 0 22 11 11 0 0 1 0-22z"/>
            <path d="M19.07 4.93l-4.24 4.24m0 5.66l4.24 4.24M4.93 4.93l4.24 4.24m5.66 0l4.24-4.24"/>
          </svg>
          <span>Settings</span>
        </button>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="admin-main">
      
      <!-- Dashboard View -->
      <section class="admin-view active" id="viewDashboard">
        <header class="admin-view-header">
          <h2>Dashboard</h2>
          <p class="admin-view-subtitle">System overview and statistics</p>
        </header>

        <!-- Stats Cards -->
        <div class="admin-stats-grid">
          <div class="admin-stat-card">
            <div class="stat-card-icon stat-card-icon-blue">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
              </svg>
            </div>
            <div class="stat-card-content">
              <p class="stat-card-label">Total Users</p>
              <p class="stat-card-value" id="statTotalUsers">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="stat-card-icon stat-card-icon-green">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
              </svg>
            </div>
            <div class="stat-card-content">
              <p class="stat-card-label">Total POIs</p>
              <p class="stat-card-value" id="statTotalPois">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="stat-card-icon stat-card-icon-purple">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              </svg>
            </div>
            <div class="stat-card-content">
              <p class="stat-card-label">Total Comments</p>
              <p class="stat-card-value" id="statTotalComments">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>

          <div class="admin-stat-card">
            <div class="stat-card-icon stat-card-icon-orange">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
              </svg>
            </div>
            <div class="stat-card-content">
              <p class="stat-card-label">Active Users (7d)</p>
              <p class="stat-card-value" id="statActiveUsers">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="admin-section">
          <h3>Recent Activity</h3>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>User</th>
                  <th>Details</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="recentActivityTable">
                <tr>
                  <td colspan="4" class="table-loading">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Quests View -->
      <section class="admin-view" id="viewQuests" hidden>
        <header class="admin-view-header">
          <div>
            <h2>Quests</h2>
            <p class="admin-view-subtitle">Manage quest tasks (category: "quest")</p>
          </div>
          <div class="admin-view-actions">
            <button class="btn-secondary" type="button" id="btnRefreshQuests">Refresh</button>
            <button class="btn-primary" type="button" id="btnAddQuest">New Quest</button>
          </div>
        </header>

        <div class="admin-table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>XP</th>
                <th>Active</th>
                <th>Sort</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="questsTableBody">
              <tr>
                <td colspan="5" class="table-loading">Loading quests...</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Users View -->
      <section class="admin-view" id="viewUsers" hidden>
        <header class="admin-view-header">
          <h2>User Management</h2>
          <p class="admin-view-subtitle">Manage user accounts and profiles</p>
        </header>

        <!-- User Search -->
        <div class="admin-search-bar">
          <input 
            type="text" 
            id="userSearch" 
            placeholder="Search users by name, email, or username..."
            class="admin-search-input"
          />
          <button class="btn-admin-search" id="btnUserSearch">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            Search
          </button>
        </div>

        <!-- Users Table -->
        <div class="admin-table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Email</th>
                <th>Level</th>
                <th>XP</th>
                <th>Joined</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="usersTable">
              <tr>
                <td colspan="7" class="table-loading">Loading users...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="admin-pagination" id="usersPagination">
          <button class="btn-pagination" id="btnUsersPrev">Previous</button>
          <span class="pagination-info" id="usersPaginationInfo">Page 1</span>
          <button class="btn-pagination" id="btnUsersNext">Next</button>
        </div>
      </section>

      <!-- POIs View -->
      <section class="admin-view" id="viewPois" hidden>
        <header class="admin-view-header">
          <div>
            <h2>Points of Interest</h2>
            <p class="admin-view-subtitle">Manage POIs and locations</p>
          </div>
          <div class="admin-view-actions">
            <span class="poi-data-source" id="poiDataSourceBadge" hidden></span>
            <button class="btn-secondary" type="button" id="btnRefreshPois" title="Reload POIs">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="23 4 23 10 17 10"/>
                <polyline points="1 20 1 14 7 14"/>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10"/>
                <path d="M20.49 15a9 9 0 0 1-14.85 3.36L1 14"/>
              </svg>
              Refresh
            </button>
            <button class="btn-primary" type="button" id="btnAddPoi">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              New POI
            </button>
          </div>
        </header>

        <!-- POI Stats -->
        <div class="admin-stats-grid poi-stats">
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Total POIs</p>
              <p class="stat-card-value" id="poiStatTotal">0</p>
              <p class="stat-card-change" id="poiStatLiveStatus">Awaiting data...</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Published</p>
              <p class="stat-card-value" id="poiStatPublished">0</p>
              <p class="stat-card-change">Live on map</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Draft / Hidden</p>
              <p class="stat-card-value" id="poiStatDrafts">0</p>
              <p class="stat-card-change">Needs review</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Missing Location</p>
              <p class="stat-card-value" id="poiStatMissingLocation">0</p>
              <p class="stat-card-change">Require GPS coordinates</p>
            </div>
          </div>
        </div>

        <!-- Filters -->
        <div class="admin-card">
          <div class="admin-card-body">
            <div class="poi-filters">
              <label class="poi-filter">
                <span>Search</span>
                <input type="search" id="poiSearchInput" placeholder="Search POIs by name, slug or description..." />
              </label>
              <label class="poi-filter">
                <span>Category</span>
                <select id="poiCategoryFilter">
                  <option value="all">All categories</option>
                </select>
              </label>
              <label class="poi-filter">
                <span>Status</span>
                <select id="poiStatusFilter">
                  <option value="all">All statuses</option>
                  <option value="published">Published</option>
                  <option value="draft">Draft</option>
                  <option value="hidden">Hidden</option>
                </select>
              </label>
            </div>
            <p class="poi-filter-helper" id="poiFilterHelper">Use filters to quickly find and audit POIs.</p>
          </div>
        </div>

        <!-- POI Table -->
        <div class="admin-table-container">
          <table class="admin-table admin-poi-table">
            <thead>
              <tr>
                <th>POI</th>
                <th>Category</th>
                <th>Coordinates</th>
                <th>Radius</th>
                <th>Updated</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="poisTableBody">
              <tr>
                <td colspan="6" class="table-loading">Loading POIs...</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="poi-table-footer" id="poiTableFooter"></div>
      </section>

      <!-- Content View -->
      <section class="admin-view" id="viewContent" hidden>
        <header class="admin-view-header">
          <h2>Content Management</h2>
          <p class="admin-view-subtitle">Manage all comments, photos and user-generated content</p>
        </header>

        <!-- Content Stats -->
        <div class="admin-stats-grid" id="contentStats">
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Total Comments</p>
              <p class="stat-card-value">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Total Photos</p>
              <p class="stat-card-value">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Total Likes</p>
              <p class="stat-card-value">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>
          <div class="admin-stat-card">
            <div class="stat-card-content">
              <p class="stat-card-label">Active Users</p>
              <p class="stat-card-value">-</p>
              <p class="stat-card-change">Loading...</p>
            </div>
          </div>
        </div>

        <!-- Search Bar -->
        <div class="admin-search-bar">
          <input 
            type="search" 
            id="contentSearchInput" 
            placeholder="Search comments by user, POI, or content..."
            class="admin-search-input"
            onkeypress="if(event.key === 'Enter') searchComments();"
          />
          <button class="btn-admin-search" onclick="searchComments()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            Search
          </button>
          <button class="btn-secondary" onclick="clearContentSearch()">
            Clear
          </button>
        </div>

        <!-- Content Table -->
        <div class="admin-table-container">
          <table class="admin-table">
            <thead>
              <tr>
                <th>User</th>
                <th>POI & Comment</th>
                <th>Info</th>
                <th>Likes</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="contentTable">
              <tr>
                <td colspan="6" class="table-loading">Loading content...</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="admin-pagination" id="contentPagination">
          <button class="btn-pagination" disabled>Previous</button>
          <span class="pagination-info">Page 1</span>
          <button class="btn-pagination" disabled>Next</button>
        </div>
      </section>

      <!-- Diagnostics View -->
      <section class="admin-view" id="viewDiagnostics" hidden>
        <header class="admin-view-header">
          <h2>System Diagnostics</h2>
          <p class="admin-view-subtitle">Monitor system health and performance</p>
        </header>

        <div class="admin-diagnostics-grid">
          <div class="diagnostic-card">
            <h4>Database Status</h4>
            <div class="diagnostic-status" id="dbStatus">
              <span class="status-indicator status-checking"></span>
              <span>Checking...</span>
            </div>
          </div>

          <div class="diagnostic-card">
            <h4>API Status</h4>
            <div class="diagnostic-status" id="apiStatus">
              <span class="status-indicator status-checking"></span>
              <span>Checking...</span>
            </div>
          </div>

          <div class="diagnostic-card">
            <h4>Storage Status</h4>
            <div class="diagnostic-status" id="storageStatus">
              <span class="status-indicator status-checking"></span>
              <span>Checking...</span>
            </div>
          </div>
        </div>

        <div class="admin-section">
          <div class="admin-view-header" style="margin-bottom: 16px; display: flex; align-items: center; justify-content: space-between; gap: 12px;">
            <div>
              <h3>Health Checks</h3>
              <p class="admin-view-subtitle">Wykrywanie problemów z konfiguracją i danymi. Możesz uruchomić pojedyncze testy lub wszystko naraz.</p>
            </div>
            <div class="admin-view-actions">
              <button class="btn-secondary" id="btnRunAllChecks">Run all</button>
            </div>
          </div>

          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Check</th>
                  <th>Status</th>
                  <th>Details</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="diagnosticChecksTable">
                <tr>
                  <td colspan="4" class="table-loading">Loading checks...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- System Metrics -->
        <div class="admin-section">
          <h3>System Metrics</h3>
          <div class="admin-table-container">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Metric</th>
                  <th>Value</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody id="systemMetricsTable">
                <tr>
                  <td colspan="3" class="table-loading">Loading metrics...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Settings View -->
      <section class="admin-view" id="viewSettings" hidden>
        <header class="admin-view-header">
          <h2>Settings</h2>
          <p class="admin-view-subtitle">Configure admin panel settings</p>
        </header>
        <div class="admin-placeholder">
          <p>Settings coming soon...</p>
        </div>
      </section>

    </main>
  </div>

  <!-- POI Detail Modal -->
  <div class="admin-modal" id="poiDetailModal" hidden>
    <div class="admin-modal-overlay" id="poiDetailModalOverlay"></div>
    <div class="admin-modal-content">
      <header class="admin-modal-header">
        <h3 id="poiDetailTitle">POI Details</h3>
        <button class="btn-modal-close" id="btnClosePoiDetail">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body" id="poiDetailContent">
        <p>Loading POI details...</p>
      </div>
    </div>
  </div>

  <!-- POI Form Modal -->
  <div class="admin-modal" id="poiFormModal" hidden>
    <div class="admin-modal-overlay" id="poiFormModalOverlay"></div>
    <div class="admin-modal-content">
      <header class="admin-modal-header">
        <h3 id="poiFormTitle">New POI</h3>
        <button class="btn-modal-close" id="btnClosePoiForm">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body">
        <form id="poiForm" class="poi-form">
          <div class="poi-form-warning" id="poiFormWarning" hidden>
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13"/>
              <line x1="12" y1="17" x2="12" y2="17"/>
            </svg>
            <span id="poiFormWarningText"></span>
          </div>
          <div class="admin-form-grid">
            <label class="admin-form-field">
              <span>Name *</span>
              <input type="text" id="poiName" name="name" required placeholder="e.g. Kato Paphos Archaeological Park" />
            </label>
            <label class="admin-form-field">
              <span>Slug</span>
              <input type="text" id="poiSlug" name="slug" placeholder="auto-generated if empty" />
            </label>
            <label class="admin-form-field">
              <span>Category</span>
              <input type="text" id="poiCategory" name="category" placeholder="e.g. heritage" />
            </label>
            <label class="admin-form-field">
              <span>Status</span>
              <select id="poiStatus" name="status">
                <option value="published">Published</option>
                <option value="draft">Draft</option>
                <option value="hidden">Hidden</option>
              </select>
            </label>
            <label class="admin-form-field">
              <span>Latitude *</span>
              <input type="number" step="0.000001" id="poiLatitude" name="latitude" placeholder="34.755670" required />
            </label>
            <label class="admin-form-field">
              <span>Longitude *</span>
              <input type="number" step="0.000001" id="poiLongitude" name="longitude" placeholder="32.404170" required />
            </label>
            <label class="admin-form-field">
              <span>Radius (m)</span>
              <input type="number" min="50" max="500" step="10" id="poiRadius" name="radius" placeholder="150" />
            </label>
            <label class="admin-form-field">
              <span>XP Reward</span>
              <input type="number" min="0" max="1000" step="5" id="poiXP" name="xp" placeholder="100" />
            </label>
            <label class="admin-form-field">
              <span>Google Link</span>
              <input type="url" id="poiGoogleUrl" name="google_url" placeholder="https://maps.app.goo.gl/..." />
            </label>
            <label class="admin-form-field">
              <span>Tags</span>
              <input type="text" id="poiTags" name="tags" placeholder="Comma separated" />
            </label>
          </div>
          <label class="admin-form-field">
            <span>Description</span>
            <textarea id="poiDescription" name="description" rows="4" placeholder="Detailed description shown to players"></textarea>
          </label>
          <div class="poi-form-error" id="poiFormError" hidden></div>
          <div class="poi-form-actions">
            <button type="button" class="btn-secondary" id="poiFormCancel">Cancel</button>
            <button type="submit" class="btn-primary" id="poiFormSubmit">Save POI</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- User Detail Modal -->
  <div class="admin-modal" id="userDetailModal" hidden>
    <div class="admin-modal-overlay" id="userDetailModalOverlay"></div>
    <div class="admin-modal-content">
      <header class="admin-modal-header">
        <h3>User Details</h3>
        <button class="btn-modal-close" id="btnCloseUserModal">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body" id="userDetailContent">
        <p>Loading user details...</p>
      </div>
    </div>
  </div>

  <!-- Comment Detail Modal -->
  <div class="admin-modal" id="commentDetailModal" hidden>
    <div class="admin-modal-overlay" id="commentDetailModalOverlay"></div>
    <div class="admin-modal-content admin-modal-content-large">
      <header class="admin-modal-header">
        <h3 id="commentDetailTitle">Comment Details</h3>
        <button class="btn-modal-close" id="btnCloseCommentDetail">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body" id="commentDetailContent">
        <p>Loading comment details...</p>
      </div>
    </div>
  </div>

  <!-- Comment Edit Modal -->
  <div class="admin-modal" id="commentEditModal" hidden>
    <div class="admin-modal-overlay" id="commentEditModalOverlay"></div>
    <div class="admin-modal-content">
      <header class="admin-modal-header">
        <h3 id="commentEditTitle">Edit Comment</h3>
        <button class="btn-modal-close" id="btnCloseCommentEdit">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body">
        <form id="commentEditForm" onsubmit="handleCommentEditSubmit(event); return false;">
          <div class="admin-form-field">
            <span>Comment Content *</span>
            <textarea 
              id="commentEditContent" 
              name="content" 
              rows="8" 
              required 
              placeholder="Enter comment content..."
              style="min-height: 150px;"
            ></textarea>
          </div>
          <div class="comment-edit-error" id="commentEditError" hidden></div>
          <div class="poi-form-actions">
            <button type="button" class="btn-secondary" id="commentEditCancel">Cancel</button>
            <button type="submit" class="btn-primary" id="commentEditSubmit">Save Changes</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Quest Form Modal -->
  <div class="admin-modal" id="questFormModal" hidden>
    <div class="admin-modal-overlay" id="questFormModalOverlay"></div>
    <div class="admin-modal-content">
      <header class="admin-modal-header">
        <h3 id="questFormTitle">New Quest</h3>
        <button class="btn-modal-close" id="btnCloseQuestForm">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </header>
      <div class="admin-modal-body">
        <form id="questForm">
          <div class="admin-form-grid">
            <label class="admin-form-field">
              <span>ID *</span>
              <input type="text" id="questId" name="id" required placeholder="sunrise-challenge" />
            </label>
            <label class="admin-form-field">
              <span>Title</span>
              <input type="text" id="questTitle" name="title" placeholder="Optional display title" />
            </label>
            <label class="admin-form-field">
              <span>XP</span>
              <input type="number" id="questXp" name="xp" min="0" step="1" value="0" />
            </label>
            <label class="admin-form-field">
              <span>Sort</span>
              <input type="number" id="questSort" name="sort_order" min="0" step="1" value="1000" />
            </label>
            <label class="admin-form-field">
              <span>Active</span>
              <select id="questActive" name="is_active">
                <option value="true" selected>Yes</option>
                <option value="false">No</option>
              </select>
            </label>
          </div>
          <label class="admin-form-field">
            <span>Description</span>
            <textarea id="questDescription" name="description" rows="3" placeholder="Optional quest description shown on /tasks"></textarea>
          </label>
          <div class="poi-form-actions">
            <button type="button" class="btn-secondary" id="questFormCancel">Cancel</button>
            <button type="submit" class="btn-primary" id="questFormSubmit">Save Quest</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toast-container" class="toast-container"></div>

</body>
</html>
